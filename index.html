
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>POS DZ - ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</title>
  <link rel="stylesheet" href="style.css"/>
  <style>
    body { display: flex; align-items: center; justify-content: center; min-height: 100vh; overflow: hidden; }

    /* Animated particles */
    .particles { position: fixed; inset: 0; z-index: 0; pointer-events: none; }
    .particle {
      position: absolute; border-radius: 50%;
      background: var(--primary); opacity: 0.18;
      animation: floatPart linear infinite;
    }
    @keyframes floatPart {
      0%   { transform: translateY(100vh) scale(0); opacity: 0; }
      10%  { opacity: 0.18; }
      90%  { opacity: 0.1; }
      100% { transform: translateY(-20px) scale(1.2); opacity: 0; }
    }

    /* Glow rings */
    .glow-ring {
      position: fixed; border-radius: 50%;
      border: 1px solid rgba(124,58,237,0.15);
      animation: pulseRing 4s ease-in-out infinite;
      pointer-events: none; z-index: 0;
    }
    @keyframes pulseRing {
      0%,100% { transform: scale(1); opacity: 0.15; }
      50%      { transform: scale(1.05); opacity: 0.25; }
    }

    /* Login card */
    .login-wrap { position: relative; z-index: 1; width: 100%; max-width: 420px; padding: 20px; }

    .login-card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      overflow: hidden;
      box-shadow: 0 20px 60px rgba(0,0,0,0.5), 0 0 40px rgba(124,58,237,0.12);
    }
    .card-glow-bar { height: 4px; background: linear-gradient(90deg, var(--primary), var(--secondary), var(--primary-light)); }
    .card-body { padding: 36px 36px 28px; }

    /* Brand */
    .brand { display: flex; align-items: baseline; justify-content: center; gap: 4px; margin-bottom: 4px; }
    .brand-pos {
      font-family: Impact, sans-serif; font-size: 3.2rem;
      color: var(--text-primary);
      text-shadow: 0 0 20px rgba(255,255,255,0.2);
    }
    .brand-dz {
      font-family: Impact, sans-serif; font-size: 3.2rem;
      color: var(--primary);
      text-shadow: 0 0 24px var(--glow);
    }
    .brand-sub { text-align: center; color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 24px; }

    .divider-line { height: 1px; background: var(--border); margin: 0 0 24px; }

    /* Form */
    .form-group { margin-bottom: 16px; }
    .form-label { display: block; font-size: 0.85rem; color: var(--text-secondary); font-weight: 600; margin-bottom: 7px; }

    .field-wrap {
      display: flex; align-items: center;
      background: var(--bg-input);
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      transition: border-color 0.2s, box-shadow 0.2s;
      overflow: hidden;
    }
    .field-wrap:focus-within {
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(124,58,237,0.18);
    }
    .field-icon { padding: 0 12px; color: var(--text-secondary); font-size: 1rem; }
    .field-wrap input, .field-wrap select {
      flex: 1; background: transparent; border: none; outline: none;
      color: var(--text-primary); padding: 11px 8px 11px 0;
      font-family: 'Cairo', sans-serif; font-size: 0.98rem;
      direction: rtl;
    }
    .field-wrap select option { background: var(--bg-card); }
    .toggle-eye {
      background: transparent; border: none;
      color: var(--text-secondary); font-size: 1rem;
      cursor: pointer; padding: 0 12px;
      transition: color 0.2s;
    }
    .toggle-eye:hover { color: var(--primary); }

    .remember-row { display: flex; align-items: center; gap: 8px; margin-bottom: 20px; }
    .remember-row input[type=checkbox] { accent-color: var(--primary); width: 16px; height: 16px; cursor: pointer; }
    .remember-row label { font-size: 0.85rem; color: var(--text-secondary); cursor: pointer; }

    .btn-login {
      width: 100%; padding: 13px;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      border: none; border-radius: var(--radius-sm);
      color: #fff; font-family: 'Cairo', sans-serif;
      font-size: 1.05rem; font-weight: 700;
      cursor: pointer; transition: var(--transition);
      box-shadow: 0 4px 16px rgba(124,58,237,0.35);
      display: flex; align-items: center; justify-content: center; gap: 8px;
    }
    .btn-login:hover { transform: translateY(-1px); box-shadow: 0 6px 24px rgba(124,58,237,0.5); }
    .btn-login:active { transform: translateY(0); }

    .error-msg { color: var(--danger); font-size: 0.88rem; text-align: center; margin-top: 10px; min-height: 20px; }

    .card-footer { padding: 14px 36px 20px; border-top: 1px solid var(--border); text-align: center; }
    .card-footer p { font-size: 0.78rem; color: var(--text-secondary); }
  </style>
</head>
<body>
<div class="bg-animated"></div>

<!-- Glow Rings -->
<div class="glow-ring" style="width:500px;height:500px;top:50%;left:50%;transform:translate(-50%,-50%);animation-delay:0s;"></div>
<div class="glow-ring" style="width:700px;height:700px;top:50%;left:50%;transform:translate(-50%,-50%);animation-delay:1.3s;"></div>
<div class="glow-ring" style="width:900px;height:900px;top:50%;left:50%;transform:translate(-50%,-50%);animation-delay:2.6s;"></div>

<!-- Particles -->
<div class="particles" id="particles"></div>

<!-- Login Card -->
<div class="login-wrap">
  <div class="login-card">
    <div class="card-glow-bar"></div>
    <div class="card-body">
      <!-- Brand -->
      <div class="brand">
        <span class="brand-pos">POS</span>
        <span class="brand-dz">DZ</span>
      </div>
      <p class="brand-sub">Ù†Ø¸Ø§Ù… Ù†Ù‚Ø§Ø· Ø§Ù„Ø¨ÙŠØ¹ Ø§Ù„Ø°ÙƒÙŠ</p>
      <div class="divider-line"></div>

      <!-- Username -->
      <div class="form-group">
        <label class="form-label">ğŸ‘¤ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
        <div class="field-wrap">
          <span class="field-icon">â—‰</span>
          <select id="usernameSelect">
            <option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… --</option>
          </select>
        </div>
      </div>

      <!-- Password -->
      <div class="form-group">
        <label class="form-label">ğŸ”‘ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ</label>
        <div class="field-wrap">
          <span class="field-icon">ğŸ”’</span>
          <input type="password" id="passwordInput" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ" autocomplete="current-password"/>
          <button class="toggle-eye" id="toggleEye" onclick="togglePassword()">ğŸ‘</button>
        </div>
      </div>

      <!-- Remember -->
      <div class="remember-row">
        <input type="checkbox" id="rememberMe" checked/>
        <label for="rememberMe">Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„</label>
      </div>

      <!-- Login Button -->
      <button class="btn-login" onclick="doLogin()">
        Ø¯Ø®ÙˆÙ„ âŸµ
      </button>

      <div class="error-msg" id="errorMsg"></div>
    </div>

    <div class="card-footer">
      <p>POS DZ v6.0.0 &nbsp;|&nbsp; 2026 Ø¨ÙˆØ³ Ø¯ÙŠØ²Ø§Ø¯ â€” Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© Â®</p>
    </div>
  </div>
</div>

<!-- Virtual Keyboard -->
<div class="vkb-overlay" id="vkbOverlay">
  <div class="vkb-container">
    <div class="vkb-row">
      <button class="vkb-key" onclick="vkbPress('1')">1</button>
      <button class="vkb-key" onclick="vkbPress('2')">2</button>
      <button class="vkb-key" onclick="vkbPress('3')">3</button>
      <button class="vkb-key" onclick="vkbPress('4')">4</button>
      <button class="vkb-key" onclick="vkbPress('5')">5</button>
      <button class="vkb-key" onclick="vkbPress('6')">6</button>
      <button class="vkb-key" onclick="vkbPress('7')">7</button>
      <button class="vkb-key" onclick="vkbPress('8')">8</button>
      <button class="vkb-key" onclick="vkbPress('9')">9</button>
      <button class="vkb-key" onclick="vkbPress('0')">0</button>
      <button class="vkb-key delete" onclick="vkbPress('âŒ«')">âŒ«</button>
    </div>
    <div class="vkb-row">
      <button class="vkb-key" onclick="vkbPress('Ø¶')">Ø¶</button>
      <button class="vkb-key" onclick="vkbPress('Øµ')">Øµ</button>
      <button class="vkb-key" onclick="vkbPress('Ø«')">Ø«</button>
      <button class="vkb-key" onclick="vkbPress('Ù‚')">Ù‚</button>
      <button class="vkb-key" onclick="vkbPress('Ù')">Ù</button>
      <button class="vkb-key" onclick="vkbPress('Øº')">Øº</button>
      <button class="vkb-key" onclick="vkbPress('Ø¹')">Ø¹</button>
      <button class="vkb-key" onclick="vkbPress('Ù‡')">Ù‡</button>
      <button class="vkb-key" onclick="vkbPress('Ø®')">Ø®</button>
      <button class="vkb-key" onclick="vkbPress('Ø­')">Ø­</button>
      <button class="vkb-key" onclick="vkbPress('Ø¬')">Ø¬</button>
    </div>
    <div class="vkb-row">
      <button class="vkb-key" onclick="vkbPress('Ø´')">Ø´</button>
      <button class="vkb-key" onclick="vkbPress('Ø³')">Ø³</button>
      <button class="vkb-key" onclick="vkbPress('ÙŠ')">ÙŠ</button>
      <button class="vkb-key" onclick="vkbPress('Ø¨')">Ø¨</button>
      <button class="vkb-key" onclick="vkbPress('Ù„')">Ù„</button>
      <button class="vkb-key" onclick="vkbPress('Ø§')">Ø§</button>
      <button class="vkb-key" onclick="vkbPress('Øª')">Øª</button>
      <button class="vkb-key" onclick="vkbPress('Ù†')">Ù†</button>
      <button class="vkb-key" onclick="vkbPress('Ù…')">Ù…</button>
      <button class="vkb-key" onclick="vkbPress('Ùƒ')">Ùƒ</button>
      <button class="vkb-key" onclick="vkbPress('Ø·')">Ø·</button>
    </div>
    <div class="vkb-row">
      <button class="vkb-key" onclick="vkbPress('A')">A</button>
      <button class="vkb-key" onclick="vkbPress('B')">B</button>
      <button class="vkb-key" onclick="vkbPress('C')">C</button>
      <button class="vkb-key" onclick="vkbPress('D')">D</button>
      <button class="vkb-key" onclick="vkbPress('E')">E</button>
      <button class="vkb-key" onclick="vkbPress('F')">F</button>
      <button class="vkb-key" onclick="vkbPress('G')">G</button>
      <button class="vkb-key" onclick="vkbPress('H')">H</button>
      <button class="vkb-key space wide" onclick="vkbPress(' ')">Ù…Ø³Ø§ÙØ©</button>
      <button class="vkb-key enter-key" onclick="doLogin()" style="background:var(--primary);color:#fff;font-weight:800;min-width:70px;">Ø¯Ø®ÙˆÙ„ â†µ</button>
      <button class="vkb-key close" onclick="vkbClose()">âœ– Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
  </div>
</div>

<!-- Sidebar â€” labels only, no icons -->
<div class="sidebar-overlay" id="sidebarOverlay" onclick="closeSidebar()"></div>
<div class="sidebar" id="sidebar">
  <div class="sidebar-header">
    <div class="sidebar-brand">POS DZ</div>
    <div class="sidebar-user" id="sidebarUser"></div>
  </div>
  <nav class="sidebar-nav">
    <a class="nav-item" href="sale.html">
      <span class="nav-label" data-nav="navSale">ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¨ÙŠØ¹</span>
    </a>
    <a class="nav-item" href="inventory.html" data-role="admin,manager">
      <span class="nav-label" data-nav="navInventory">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</span>
    </a>
    <a class="nav-item" href="customers.html" data-role="admin,manager,seller">
      <span class="nav-label" data-nav="navCustomers">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø²Ø¨Ø§Ø¦Ù†</span>
    </a>
    <a class="nav-item" href="reports.html" data-role="admin,manager">
      <span class="nav-label" data-nav="navReports">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø¹Ù…Ø§Ù„</span>
    </a>
    <a class="nav-item" href="users.html" data-role="admin">
      <span class="nav-label" data-nav="navUsers">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</span>
    </a>
    <a class="nav-item" href="suppliers.html" data-role="admin,manager">
      <span class="nav-label" data-nav="navSuppliers">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ²Ø¹ÙŠÙ†</span>
    </a>
    <a class="nav-item" href="settings.html" data-role="admin,manager">
      <span class="nav-label" data-nav="navSettings">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©</span>
    </a>
    <div class="nav-item danger" onclick="doLogout()">
      <span class="nav-label" data-nav="navLogout">Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</span>
    </div>
  </nav>
  <div class="sidebar-footer">POS DZ v6.0.0 | 2026 Ø¨ÙˆØ³ Ø¯ÙŠØ²Ø§Ø¯ Â®</div>
</div>
<div id="toast-container"></div>

<script src="app.js"></script>
<script>
// â”€â”€ Particles â”€â”€
(function() {
  const container = document.getElementById('particles');
  for (let i = 0; i < 18; i++) {
    const p = document.createElement('div');
    p.className = 'particle';
    const size = Math.random() * 8 + 3;
    p.style.cssText = `
      width:${size}px; height:${size}px;
      left:${Math.random()*100}%;
      animation-duration:${Math.random()*10+6}s;
      animation-delay:${Math.random()*8}s;
      background:${Math.random()>0.5 ? 'var(--primary)' : 'var(--secondary)'};
    `;
    container.appendChild(p);
  }
})();

// â”€â”€ Password Toggle â”€â”€
function togglePassword() {
  const inp = document.getElementById('passwordInput');
  const btn = document.getElementById('toggleEye');
  if (inp.type === 'password') { inp.type = 'text'; btn.textContent = 'ğŸ™ˆ'; }
  else { inp.type = 'password'; btn.textContent = 'ğŸ‘'; }
}

// â”€â”€ Load Users â”€â”€
async function loadUsers() {
  await openDB();
  await applyTheme();
  const users = await dbGetAll('users');
  const sel = document.getElementById('usernameSelect');
  sel.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… --</option>';
  users.forEach(u => {
    const opt = document.createElement('option');
    opt.value = u.username;
    opt.textContent = u.username + (u.role === 'admin' ? ' ğŸ‘‘' : u.role === 'manager' ? ' ğŸ›¡' : ' ğŸ‘¤');
    sel.appendChild(opt);
  });
  // Auto-fill if remembered
  const saved = localStorage.getItem('posdz_last_user');
  if (saved) sel.value = saved;
}

// â”€â”€ Login â”€â”€
async function doLogin() {
  const username = document.getElementById('usernameSelect').value;
  const password = document.getElementById('passwordInput').value;
  const errEl = document.getElementById('errorMsg');

  if (!username || !password) {
    errEl.textContent = 'âš ï¸ ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆØ¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ';
    return;
  }

  const users = await dbGetAll('users');
  const user = users.find(u => u.username === username && u.password === hashPassword(password));

  if (user) {
    errEl.textContent = '';
    saveSession(user);
    if (document.getElementById('rememberMe').checked) {
      localStorage.setItem('posdz_last_user', username);
    }
    toast('Ù…Ø±Ø­Ø¨Ø§Ù‹ ' + user.username + '! ğŸ‰', 'success', 1200);
    // Fire login notification (stored in localStorage, shown on next page)
    try { notifLogin(user.username); } catch(e) {}
    setTimeout(() => { window.location.href = 'sale.html'; }, 1000);
  } else {
    errEl.textContent = 'âŒ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ ØºÙŠØ± ØµØ­ÙŠØ­';
    document.getElementById('passwordInput').style.borderColor = 'var(--danger)';
    setTimeout(() => { document.getElementById('passwordInput').style.borderColor = ''; }, 1500);
  }
}

// Enter key
document.addEventListener('keydown', e => { if (e.key === 'Enter') doLogin(); });

loadUsers();
initVirtualKeyboard();
</script>
</body>
</html>
