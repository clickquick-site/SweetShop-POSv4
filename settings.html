<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>POS DZ - ุงูุฅุนุฏุงุฏุงุช ุงูุนุงูุฉ</title>
  <link rel="stylesheet" href="style.css"/>
  <style>
    .setting-row { display:flex;justify-content:space-between;align-items:center;padding:14px 0;border-bottom:1px solid var(--border); }
    .setting-row:last-child { border-bottom:none; }
    .setting-label { font-size:0.95rem;font-weight:600; }
    .setting-desc { font-size:0.78rem;color:var(--text-secondary);margin-top:2px; }
    .theme-colors { display:flex;gap:10px;flex-wrap:wrap; }
    .theme-dot { width:38px;height:38px;border-radius:50%;cursor:pointer;border:3px solid transparent;transition:var(--transition);box-shadow:0 2px 8px rgba(0,0,0,0.3); }
    .theme-dot.active,.theme-dot:hover { border-color:#fff;transform:scale(1.18); }
    .preview-box {
      background:#111;border:1px solid var(--border);border-radius:var(--radius);
      padding:14px 18px;font-size:12px;font-family:'Courier New',monospace;
      white-space:pre;min-height:300px;color:#ddd;line-height:1.55;overflow-x:auto;
    }
    .logo-preview { width:80px;height:80px;border-radius:var(--radius-sm);object-fit:cover;border:2px solid var(--border); }
    .danger-zone { border:1px solid rgba(239,68,68,0.3);border-radius:var(--radius);padding:20px;margin-top:16px; }
    .danger-zone h4 { color:var(--danger);margin-bottom:12px; }
    .printer-card {
      border:2px solid var(--border);border-radius:var(--radius);
      padding:14px;margin-bottom:12px;cursor:pointer;
      transition:var(--transition);background:var(--bg-medium);
    }
    .printer-card:hover { border-color:var(--primary); }
    .printer-card.selected { border-color:var(--primary);background:rgba(124,58,237,0.08); }
    .printer-card-title { font-weight:700;font-size:0.95rem;margin-bottom:4px; }
    .printer-card-desc { font-size:0.78rem;color:var(--text-secondary); }
    .barcode-preview-box {
      background:#fff;border:2px dashed var(--border);border-radius:var(--radius);
      padding:16px;text-align:center;min-height:140px;
      display:flex;flex-direction:column;align-items:center;justify-content:center;
    }
    .barcode-bars { display:flex;align-items:flex-end;gap:0;justify-content:center;margin:6px 0; }
    .barcode-bar { display:inline-block; }
    .section-divider { height:1px;background:var(--border);margin:18px 0; }
    .bg-mode-btn {
      padding:10px 22px;border-radius:8px;cursor:pointer;
      border:2px solid var(--border);font-size:0.88rem;
      font-weight:700;transition:var(--transition);
      font-family:'Cairo',sans-serif;
    }
    .bg-mode-btn.sel-dark { border-color:var(--primary)!important;box-shadow:0 0 12px var(--glow); }
    .bg-mode-btn.sel-light { border-color:#777!important; }
  </style>
</head>
<body>
<div class="bg-animated"></div>
<div class="page-wrapper">
  <header class="app-header">
    <button class="menu-btn" id="menuBtn" title="ุงููุงุฆูุฉ ุงูุฑุฆูุณูุฉ">โฐ</button>
    <span class="store-name" id="headerStoreName">ุงุณู ุงููุชุฌุฑ</span>
    <!-- Bell injected by app.js via _injectBell() -->
    <div class="app-brand">
      <span class="brand-title">POS DZ</span>
      <span class="brand-clock" id="clockDisplay"></span>
    </div>
  </header>
  <div class="main-content">
    <div class="section-header">
      <a href="sale.html" class="back-btn" id="backBtn">โ ุฑุฌูุน</a>
      <h2 class="page-title" id="pageTitle">โ๏ธ ุงูุฅุนุฏุงุฏุงุช ุงูุนุงูุฉ</h2>
    </div>

    <div class="tabs-bar">
      <button class="tab-btn active" onclick="switchTab('program')" id="tabBtnProgram">๐ป ุงูุจุฑูุงูุฌ</button>
      <button class="tab-btn" onclick="switchTab('store')"   id="tabBtnStore">๐ช ุงููุชุฌุฑ</button>
      <button class="tab-btn" onclick="switchTab('print')"   id="tabBtnPrint">๐จ๏ธ ุงูุทุจุงุนุฉ</button>
      <button class="tab-btn" onclick="switchTab('sync')"    id="tabBtnSync">โ๏ธ ุงููุฒุงููุฉ</button>
      <button class="tab-btn" onclick="switchTab('scale')"   id="tabBtnScale">โ๏ธ ุงูููุฒุงู</button>
      <button class="tab-btn" onclick="switchTab('system')"  id="tabBtnSystem">๐ง ุงููุธุงู</button>
      <button class="tab-btn" onclick="switchTab('notifs')"  id="tabBtnNotifs">๐ ุงูุฅุดุนุงุฑุงุช</button>
      <button class="tab-btn" onclick="switchTab('about')"   id="tabBtnAbout">โน๏ธ ุญูู</button>
    </div>

    <!-- โโโ TAB: ุงูุจุฑูุงูุฌ โโโ -->
    <div class="tab-content active" id="tab-program">
      <div class="card">
        <div class="setting-row">
          <div><div class="setting-label" data-i18n="labelDate">๐ ุตูุบุฉ ุงูุชุงุฑูุฎ</div></div>
          <select class="select-field" id="dateFormat" style="width:200px;">
            <option value="DD/MM/YYYY">ููู / ุดูุฑ / ุณูุฉ</option>
            <option value="MM/DD/YYYY">ุดูุฑ / ููู / ุณูุฉ</option>
            <option value="YYYY/MM/DD">ุณูุฉ / ุดูุฑ / ููู</option>
          </select>
        </div>

        <div class="setting-row">
          <div><div class="setting-label" data-i18n="labelCurrency">๐ฐ ุฑูุฒ ุงูุนููุฉ</div></div>
          <select class="select-field" id="currency" style="width:240px;">
            <option value="ุฏุฌ">๐ฉ๐ฟ ุฏููุงุฑ ุฌุฒุงุฆุฑู โ ุฏุฌ</option>
            <option value="DA">๐ฉ๐ฟ ุฏููุงุฑ ุฌุฒุงุฆุฑู โ DA</option>
            <option value="EGP">๐ช๐ฌ ุฌููู ูุตุฑู โ EGP</option>
            <option value="SAR">๐ธ๐ฆ ุฑูุงู ุณุนูุฏู โ SAR</option>
            <option value="AED">๐ฆ๐ช ุฏุฑูู ุฅูุงุฑุงุชู โ AED</option>
            <option value="MAD">๐ฒ๐ฆ ุฏุฑูู ูุบุฑุจู โ MAD</option>
            <option value="TND">๐น๐ณ ุฏููุงุฑ ุชููุณู โ TND</option>
            <option value="LYD">๐ฑ๐พ ุฏููุงุฑ ููุจู โ LYD</option>
            <option value="KWD">๐ฐ๐ผ ุฏููุงุฑ ูููุชู โ KWD</option>
            <option value="QAR">๐ถ๐ฆ ุฑูุงู ูุทุฑู โ QAR</option>
            <option value="USD">๐บ๐ธ ุฏููุงุฑ โ USD</option>
            <option value="EUR">๐ช๐บ ููุฑู โ EUR</option>
          </select>
        </div>

        <div class="setting-row">
          <div>
            <div class="setting-label" data-i18n="labelLang">๐ ูุบุฉ ุงูุจุฑูุงูุฌ</div>
            <div class="setting-desc" data-i18n="labelLangDesc">ุชุทุจูู ููุฑู ุนูู ูู ุตูุญุงุช ุงูุชุทุจูู</div>
          </div>
          <select class="select-field" id="language" style="width:200px;" onchange="onLangChange(this.value)">
            <option value="ar">๐ฉ๐ฟ ุงูุนุฑุจูุฉ</option>
            <option value="fr">๐ซ๐ท Franรงais</option>
            <option value="en">๐ฌ๐ง English</option>
          </select>
        </div>

        <div class="setting-row">
          <div><div class="setting-label" data-i18n="labelFont">๐ค ุฎุท ุงูุชุทุจูู</div></div>
          <select class="select-field" id="appFont" style="width:230px;" onchange="applyFontPreview(this.value)">
            <option value="Cairo">Cairo โ ุนุฑุจู ุฃุณุงุณู</option>
            <option value="Tajawal">Tajawal โ ุนุฑุจู ุญุฏูุซ</option>
            <option value="Amiri">Amiri โ ุนุฑุจู ููุงุณููู</option>
            <option value="Almarai">Almarai โ ุนุฑุจู ูุณุชุฏูุฑ</option>
            <option value="IBM Plex Sans Arabic">IBM Plex Arabic</option>
          </select>
        </div>

        <div class="setting-row">
          <div><div class="setting-label" data-i18n="labelFontSize">๐ก ุญุฌู ุงูุฎุท</div></div>
          <div style="display:flex;align-items:center;gap:12px;">
            <button class="btn btn-secondary btn-sm" onclick="changeFontSize(-1)" title="ุชุตุบูุฑ">โ</button>
            <span id="fontSizeDisplay" style="font-size:1rem;min-width:40px;text-align:center;font-weight:700;">15</span>
            <button class="btn btn-secondary btn-sm" onclick="changeFontSize(1)" title="ุชูุจูุฑ">+</button>
          </div>
        </div>

        <!-- Background mode -->
        <div class="setting-row" style="flex-direction:column;align-items:flex-start;gap:10px;">
          <div class="setting-label" data-i18n="labelBgMode">๐ ูุถุน ุงูุฎูููุฉ</div>
          <div style="display:flex;gap:12px;">
            <button id="btnBgDark"
              class="bg-mode-btn sel-dark"
              style="background:#0F0A1E;color:#fff;"
              onclick="selectBg('dark')" title="ูุถุน ูููู">
              ๐ <span data-i18n="bgDark">ุฏุงูู โ Mode nuit</span>
            </button>
            <button id="btnBgLight"
              class="bg-mode-btn"
              style="background:#F0F0F5;color:#111;"
              onclick="selectBg('light')" title="ูุถุน ููุงุฑู">
              โ๏ธ <span data-i18n="bgLight">ูุงุชุญ โ Mode jour</span>
            </button>
          </div>
        </div>

        <!-- Accent Colors โ visible ONLY in light mode -->
        <div id="accentDotsRow" class="setting-row" style="flex-direction:column;align-items:flex-start;gap:10px;display:none;">
          <div class="setting-label" data-i18n="labelAccentColor">๐จ ููู ุงูุฃููููุงุช ูุงูุฃุฒุฑุงุฑ</div>
          <div class="theme-colors">
            <div class="theme-dot" data-theme="blue_purple"
              style="background:linear-gradient(135deg,#7C3AED,#2563EB);"
              title="ุจููุณุฌู ุฃุฒุฑู" onclick="selectAccent('blue_purple')"></div>
            <div class="theme-dot" data-theme="green"
              style="background:linear-gradient(135deg,#059669,#0891B2);"
              title="ุฃุฎุถุฑ" onclick="selectAccent('green')"></div>
            <div class="theme-dot" data-theme="blue"
              style="background:linear-gradient(135deg,#2563EB,#0891B2);"
              title="ุฃุฒุฑู" onclick="selectAccent('blue')"></div>
            <div class="theme-dot" data-theme="orange"
              style="background:linear-gradient(135deg,#EA580C,#D97706);"
              title="ุจุฑุชูุงูู" onclick="selectAccent('orange')"></div>
            <div class="theme-dot" data-theme="red"
              style="background:linear-gradient(135deg,#DC2626,#9333EA);"
              title="ุฃุญูุฑ" onclick="selectAccent('red')"></div>
          </div>
        </div>

        <div class="section-divider"></div>
        <div class="setting-row">
          <div><div class="setting-label" data-i18n="labelSoundAdd">๐ ุตูุช ุฅุถุงูุฉ ุงูููุชุฌ</div></div>
          <label class="toggle-switch"><input type="checkbox" id="soundAdd"/><div class="toggle-track"><div class="toggle-thumb"></div></div></label>
        </div>
        <div class="setting-row">
          <div><div class="setting-label" data-i18n="labelSoundSell">๐ ุตูุช ุฅุชูุงู ุงูุจูุน</div></div>
          <label class="toggle-switch"><input type="checkbox" id="soundSell"/><div class="toggle-track"><div class="toggle-thumb"></div></div></label>
        </div>
        <div class="setting-row">
          <div><div class="setting-label" data-i18n="labelSoundBtn">๐ ุตูุช ุงูุฃุฒุฑุงุฑ</div></div>
          <label class="toggle-switch"><input type="checkbox" id="soundButtons"/><div class="toggle-track"><div class="toggle-thumb"></div></div></label>
        </div>

        <div class="section-divider"></div>
        <div class="setting-row">
          <div>
            <div class="setting-label" data-i18n="labelBarcode">๐ท ุชูุนูู ูุงุฑุฆ ุงูุจุงุฑููุฏ</div>
            <div class="setting-desc" data-i18n="labelBarcodeDesc">ุฌูุงุฒ ุงูุจุงุฑููุฏ ูุถูู ุงูููุชุฌุงุช ุชููุงุฆูุงู ุนูุฏ ุงูุชูุนูู</div>
          </div>
          <label class="toggle-switch"><input type="checkbox" id="barcodeReader"/><div class="toggle-track"><div class="toggle-thumb"></div></div></label>
        </div>
        <div class="setting-row">
          <div><div class="setting-label" data-i18n="labelBarcodeAuto">๐ท ุญุฌุฒ ุงูููุชุฌุงุช ุชููุงุฆูุงู</div></div>
          <label class="toggle-switch"><input type="checkbox" id="barcodeAuto"/><div class="toggle-track"><div class="toggle-thumb"></div></div></label>
        </div>
        <div class="setting-row">
          <div>
            <div class="setting-label" data-i18n="labelTouchKb">โจ๏ธ ุงูููุจูุฑุฏ ุงูุงูุชุฑุงุถู (ุดุงุดุงุช ุงูููุณ)</div>
            <div class="setting-desc" data-i18n="labelTouchKbDesc">ุฒุฑ ุนูู ุฌุงูุจ ุงูุดุงุดุฉ ูุงุจู ููุณุญุจ</div>
          </div>
          <label class="toggle-switch"><input type="checkbox" id="touchKeyboard"/><div class="toggle-track"><div class="toggle-thumb"></div></div></label>
        </div>

        <button class="btn btn-success mt-3" onclick="saveSettings('program')" data-i18n="saveBtn">๐พ ุญูุธ ุงูุจูุงูุงุช</button>
      </div>
    </div>

    <!-- โโโ TAB: ุงููุชุฌุฑ โโโ -->
    <div class="tab-content" id="tab-store">
      <div class="card">
        <div class="setting-row" style="flex-direction:column;align-items:flex-start;gap:12px;">
          <div class="setting-label">๐ผ๏ธ ุดุนุงุฑ ุงููุชุฌุฑ</div>
          <div style="display:flex;align-items:center;gap:14px;">
            <img id="logoPreview" class="logo-preview" style="display:none;" src=""/>
            <div style="display:flex;flex-direction:column;gap:8px;">
              <label class="btn btn-secondary btn-sm" style="cursor:pointer;">
                ๐ ุชุญููู ุงูุดุนุงุฑ <input type="file" accept="image/*" style="display:none;" onchange="loadLogo(this)"/>
              </label>
              <button class="btn btn-danger btn-sm" onclick="deleteLogo()">๐๏ธ ุญุฐู</button>
            </div>
          </div>
        </div>
        <div class="input-group">
          <label class="input-label">๐ช ุงุณู ุงููุชุฌุฑ</label>
          <input class="input-field" type="text" id="storeName" placeholder="ุงุณู ูุชุฌุฑู" oninput="updateInvoicePreview()"/>
        </div>
        <div class="input-group">
          <label class="input-label">๐ ุฑูู ุงููุงุชู</label>
          <input class="input-field" type="tel" id="storePhone" placeholder="0700000000" oninput="updateInvoicePreview()"/>
        </div>
        <div class="input-group">
          <label class="input-label">๐ ุงูุนููุงู</label>
          <input class="input-field" type="text" id="storeAddress" placeholder="ุนููุงู ุงููุชุฌุฑ" oninput="updateInvoicePreview()"/>
        </div>
        <div class="input-group">
          <label class="input-label">๐ฌ ุฑุณุงูุฉ ุงูุชุฑุญูุจ</label>
          <input class="input-field" type="text" id="storeWelcome" placeholder="ุดูุฑุงู ูุฒูุงุฑุชูู" oninput="updateInvoicePreview()"/>
        </div>
        <button class="btn btn-success mt-3" onclick="saveSettings('store')" data-i18n="saveBtn">๐พ ุญูุธ ุงูุจูุงูุงุช</button>
      </div>
    </div>

    <!-- โโโ TAB: ุงูุทุจุงุนุฉ โโโ -->
    <div class="tab-content" id="tab-print">
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:18px;align-items:start;">

        <!-- Col 1 -->
        <div style="display:flex;flex-direction:column;gap:16px;">

          <!-- ูุงุชูุฑุฉ ุงูุฒุจูู -->
          <div class="card">
            <h4 style="color:var(--primary-light);margin-bottom:14px;">๐งพ ูุงุชูุฑุฉ ุงูุฒุจูู</h4>

            <div class="input-group">
              <label class="input-label">๐ข ุฑูู ุงููุงุชูุฑุฉ ุงูุญุงูู</label>
              <input class="input-field" type="number" id="invoiceNumber" min="1"/>
            </div>

            <div class="input-group">
              <label class="input-label">๐ ููุงุณ ุงููุฑู</label>
              <select class="select-field" id="paperSize" onchange="updateInvoicePreview()">
                <option value="58mm">58 ูู โ ุญุฑุงุฑูุฉ ุตุบูุฑุฉ</option>
                <option value="80mm" selected>80 ูู โ ุญุฑุงุฑูุฉ ุนุงุฏูุฉ</option>
                <option value="A5">A5</option>
                <option value="A4">A4</option>
              </select>
            </div>

            <div class="input-group">
              <label class="input-label">๐จ๏ธ ุทุงุจุนุฉ ุงูููุงุชูุฑ</label>
              <div class="printer-card selected" id="printerInvoiceCard">
                <div class="printer-card-title">๐จ๏ธ <span id="printerInvoiceName">ุงูุทุงุจุนุฉ ุงูุงูุชุฑุงุถูุฉ</span></div>
                <div class="printer-card-desc">ุงุถุบุท ุนูู ุงูุฒุฑ ููุชุญ ุฅุนุฏุงุฏุงุช ุงูุทุงุจุนุฉ</div>
              </div>
              <div style="display:flex;gap:8px;">
                <button class="btn btn-secondary btn-sm" onclick="openPrinterDialog('invoice')" title="ูุชุญ ุฅุนุฏุงุฏุงุช ุงูุทุงุจุนุฉ ูู ุงูุญุงุณูุจ">๐ฅ๏ธ ุงุฎุชูุงุฑ ุงูุทุงุจุนุฉ</button>
                <button class="btn btn-primary btn-sm" onclick="testPrintInvoice()" title="ุทุจุงุนุฉ ุชุฌุฑูุจูุฉ">๐ ุชุฌุฑูุจู</button>
              </div>
            </div>

            <div class="section-divider"></div>
            <p style="font-size:0.82rem;color:var(--text-secondary);margin-bottom:10px;">โ๏ธ ูุญุชูู ุงููุงุชูุฑุฉ โ ุงูุชุบููุฑ ูุธูุฑ ูุจุงุดุฑุฉ ูู ุงููุนุงููุฉ</p>
            <div class="setting-row"><span class="setting-label" style="font-size:0.88rem;">๐ผ๏ธ ุดุนุงุฑ ุงููุชุฌุฑ</span>
              <label class="toggle-switch"><input type="checkbox" id="printLogo" onchange="updateInvoicePreview()"/><div class="toggle-track"><div class="toggle-thumb"></div></div></label>
            </div>
            <div class="setting-row"><span class="setting-label" style="font-size:0.88rem;">๐ช ุงุณู ุงููุชุฌุฑ</span>
              <label class="toggle-switch"><input type="checkbox" id="printName" onchange="updateInvoicePreview()"/><div class="toggle-track"><div class="toggle-thumb"></div></div></label>
            </div>
            <div class="setting-row"><span class="setting-label" style="font-size:0.88rem;">๐ ุฑูู ุงููุงุชู</span>
              <label class="toggle-switch"><input type="checkbox" id="printPhone" onchange="updateInvoicePreview()"/><div class="toggle-track"><div class="toggle-thumb"></div></div></label>
            </div>
            <div class="setting-row"><span class="setting-label" style="font-size:0.88rem;">๐ ุงูุนููุงู</span>
              <label class="toggle-switch"><input type="checkbox" id="printAddress" onchange="updateInvoicePreview()"/><div class="toggle-track"><div class="toggle-thumb"></div></div></label>
            </div>
            <div class="setting-row"><span class="setting-label" style="font-size:0.88rem;">๐ฌ ุฑุณุงูุฉ ุงูุชุฑุญูุจ</span>
              <label class="toggle-switch"><input type="checkbox" id="printWelcome" onchange="updateInvoicePreview()"/><div class="toggle-track"><div class="toggle-thumb"></div></div></label>
            </div>
            <div class="setting-row"><span class="setting-label" style="font-size:0.88rem;">๐ ุจุงุฑููุฏ ุงููุงุชูุฑุฉ</span>
              <label class="toggle-switch"><input type="checkbox" id="printBarcode" onchange="updateInvoicePreview()"/><div class="toggle-track"><div class="toggle-thumb"></div></div></label>
            </div>
            <button class="btn btn-success mt-3" onclick="saveSettings('print')" data-i18n="saveBtn">๐พ ุญูุธ ุฅุนุฏุงุฏุงุช ุงููุงุชูุฑุฉ</button>
          </div>

          <!-- ููุตู ุงูุจุงุฑููุฏ -->
          <div class="card">
            <h4 style="color:var(--primary-light);margin-bottom:14px;">๐ท๏ธ ููุตู ุงูุจุงุฑููุฏ</h4>

            <div class="input-group">
              <label class="input-label">๐จ๏ธ ุทุงุจุนุฉ ุงูุจุงุฑููุฏ</label>
              <div class="printer-card" id="printerBarcodeCard">
                <div class="printer-card-title">๐จ๏ธ <span id="printerBarcodeName">ุงูุทุงุจุนุฉ ุงูุงูุชุฑุงุถูุฉ</span></div>
                <div class="printer-card-desc">ุงุถุบุท ุนูู ุงูุฒุฑ ููุชุญ ุฅุนุฏุงุฏุงุช ุงูุทุงุจุนุฉ</div>
              </div>
              <button class="btn btn-secondary btn-sm" onclick="openPrinterDialog('barcode')" title="ูุชุญ ุฅุนุฏุงุฏุงุช ุงูุทุงุจุนุฉ">๐ฅ๏ธ ุงุฎุชูุงุฑ ุงูุทุงุจุนุฉ</button>
            </div>

            <div class="section-divider"></div>
            <p style="font-size:0.82rem;color:var(--text-secondary);margin-bottom:10px;">โ๏ธ ูุญุชูู ุงูููุตู</p>
            <div class="setting-row"><span class="setting-label" style="font-size:0.88rem;">๐ช ุงุณู ุงููุชุฌุฑ ุนูู ุงูููุตู</span>
              <label class="toggle-switch"><input type="checkbox" id="barcodeShowStore" onchange="updateBarcodePreview()" checked/><div class="toggle-track"><div class="toggle-thumb"></div></div></label>
            </div>
            <div class="setting-row"><span class="setting-label" style="font-size:0.88rem;">๐ท๏ธ ุงุณู ุงูููุชุฌ</span>
              <label class="toggle-switch"><input type="checkbox" id="barcodeShowName" onchange="updateBarcodePreview()" checked/><div class="toggle-track"><div class="toggle-thumb"></div></div></label>
            </div>
            <div class="setting-row"><span class="setting-label" style="font-size:0.88rem;">๐ฐ ุงูุณุนุฑ</span>
              <label class="toggle-switch"><input type="checkbox" id="barcodeShowPrice" onchange="updateBarcodePreview()" checked/><div class="toggle-track"><div class="toggle-thumb"></div></div></label>
            </div>

            <div class="input-group mt-3">
              <label class="input-label">๐ ููุน ุงูุจุงุฑููุฏ</label>
              <select class="select-field" id="barcodeType" onchange="updateBarcodePreview()">
                <option value="CODE128">CODE 128 (ููุตู ุจู)</option>
                <option value="EAN13">EAN-13</option>
                <option value="EAN8">EAN-8</option>
                <option value="UPCA">UPC-A</option>
                <option value="QR">QR Code</option>
              </select>
            </div>

            <div class="input-group">
              <label class="input-label">๐ค ุฎุท ุงูููุตู</label>
              <select class="select-field" id="barcodeFont" onchange="updateBarcodePreview()">
                <option value="Cairo">Cairo (ุนุฑุจู)</option>
                <option value="Arial">Arial</option>
                <option value="Courier New">Courier New (ุงุญุชุฑุงูู)</option>
                <option value="Tahoma">Tahoma</option>
              </select>
            </div>

            <button class="btn btn-success mt-3" onclick="saveSettings('barcode')">๐พ ุญูุธ ุฅุนุฏุงุฏุงุช ุงูุจุงุฑููุฏ</button>
          </div>
        </div>

        <!-- Col 2: Previews -->
        <div style="display:flex;flex-direction:column;gap:16px;position:sticky;top:70px;">
          <!-- Invoice preview -->
          <div class="card">
            <h4 style="color:var(--primary-light);margin-bottom:12px;">๐๏ธ ูุนุงููุฉ ุงููุงุชูุฑุฉ</h4>
            <div class="preview-box" id="invoicePreview">ุฌุงุฑู ุงูุชุญููู...</div>
          </div>
          <!-- Barcode label preview -->
          <div class="card">
            <h4 style="color:var(--primary-light);margin-bottom:12px;">๐ท๏ธ ูุนุงููุฉ ููุตู ุงูุจุงุฑููุฏ</h4>
            <div class="barcode-preview-box">
              <div id="bpStoreName" style="font-size:11px;font-weight:700;color:#000;margin-bottom:2px;"></div>
              <div id="bpProductName" style="font-size:13px;font-weight:900;color:#000;margin-bottom:4px;">ุณูุฑ โ 1ูุบ</div>
              <div class="barcode-bars" id="bpBars"></div>
              <div id="bpCode" style="font-family:'Courier New',monospace;font-size:10px;color:#000;margin:2px 0;">6191234567890</div>
              <div id="bpPrice" style="font-size:15px;font-weight:900;color:#000;margin-top:3px;">150.00 ุฏุฌ</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- โโโ TAB: ุงููุธุงู โโโ -->
    <div class="tab-content" id="tab-system">
      <div class="card">
        <div class="setting-row">
          <div>
            <div class="setting-label">๐พ ุงููุณุฎ ุงูุงุญุชูุงุทู ุงูุชููุงุฆู ุงููููู</div>
            <div class="setting-desc">ูุชู ุฅูุดุงุก ูุณุฎุฉ ุงุญุชูุงุทูุฉ ุชููุงุฆูุงู ูู ููู</div>
          </div>
          <label class="toggle-switch"><input type="checkbox" id="autoBackup"/><div class="toggle-track"><div class="toggle-thumb"></div></div></label>
        </div>
        <button class="btn btn-primary mt-3" onclick="createBackup()" title="ุชุญููู ูุณุฎุฉ ุงุญุชูุงุทูุฉ">๐พ ุฅูุดุงุก ูุณุฎุฉ ุงุญุชูุงุทูุฉ ุงูุขู</button>
      </div>
      <div class="danger-zone">
        <h4>๐๏ธ ุฅุฏุงุฑุฉ ุงูุจูุงูุงุช</h4>
        <p class="text-muted text-sm mb-3">ุงุญุฐุฑ! ูุฐู ุงูุนูููุงุช ูุง ูููู ุงูุชุฑุงุฌุน ุนููุง</p>
        <div style="display:flex;gap:12px;flex-wrap:wrap;">
          <button class="btn btn-warning" onclick="partialClear()">โ๏ธ ูุณุญ ุฌุฒุฆู</button>
          <button class="btn btn-danger" onclick="fullClear()">๐๏ธ ูุณุญ ููู</button>
        </div>
        <div class="alert alert-warning mt-3">
          <span>โ๏ธ</span>
          <div>
            <b>ุงููุณุญ ุงูุฌุฒุฆู:</b> ููุณุญ ุงููุจูุนุงุชุ ุงูุฏูููุ ุงูุณุฌู ููุท โ ููุจูู ุงูููุชุฌุงุช ูุงูุฒุจุงุฆู.<br/>
            <b>ุงููุณุญ ุงูููู:</b> ููุณุญ ูู ุดูุก ููุงุฆูุงู.
          </div>
        </div>
      </div>
    </div>

    <!-- โโโ TAB: ุงููุฒุงููุฉ โโโ -->
    <div class="tab-content" id="tab-sync">
      <div class="card">
        <h4 style="color:var(--primary-light);margin-bottom:16px;">โ๏ธ ูุฒุงููุฉ ุงูุจูุงูุงุช โ Multi-Device Sync</h4>
        <div style="background:linear-gradient(135deg,var(--bg-dark),var(--bg-medium));border:1px solid var(--primary);border-radius:var(--radius);padding:18px;margin-bottom:18px;">
          <div style="font-size:0.82rem;color:var(--text-secondary);margin-bottom:12px;line-height:1.7;">
            ุชุชูุญ ูุฐู ุงูุฎุงุตูุฉ ุฑุจุท ุนุฏุฉ ุฃุฌูุฒุฉ ุจูุงุนุฏุฉ ุจูุงูุงุช ูุงุญุฏุฉ ูุดุชุฑูุฉ ุนูู ุงูุณุญุงุจุฉ.<br/>
            ุงูุจูุงูุงุช ุชูุญุฏููุซ ููุฑูุงู ุนูู ูู ุงูุฃุฌูุฒุฉ ุนูุฏ ุญุฏูุซ ุฃู ุจูุน ุฃู ุชุบููุฑ.
          </div>
          <div style="display:flex;gap:10px;flex-wrap:wrap;margin-bottom:14px;">
            <span style="background:rgba(124,58,237,0.15);border:1px solid var(--primary);border-radius:20px;padding:4px 12px;font-size:0.78rem;color:var(--primary-light);">๐ Real-time Sync</span>
            <span style="background:rgba(37,99,235,0.15);border:1px solid #2563EB;border-radius:20px;padding:4px 12px;font-size:0.78rem;color:#60A5FA;">๐ก Multi-device</span>
            <span style="background:rgba(5,150,105,0.15);border:1px solid var(--success);border-radius:20px;padding:4px 12px;font-size:0.78rem;color:var(--success);">๐ถ Offline-first</span>
            <span style="background:rgba(234,88,12,0.15);border:1px solid var(--warning);border-radius:20px;padding:4px 12px;font-size:0.78rem;color:var(--warning);">๐ API Integration</span>
          </div>
        </div>

        <div class="setting-row">
          <div><div class="setting-label">๐ ุชูุนูู ุงููุฒุงููุฉ ุงูุณุญุงุจูุฉ</div><div class="setting-desc">Real-time Synchronization ุนุจุฑ Firebase</div></div>
          <label class="toggle-switch"><input type="checkbox" id="syncEnabled" onchange="toggleSync()"/><div class="toggle-track"><div class="toggle-thumb"></div></div></label>
        </div>
        <div id="syncConfig" style="display:none;">
          <div class="setting-row" style="margin-top:12px;">
            <div><div class="setting-label">๐ ููุชุงุญ ุงูุฎุงุฏู (Server Key)</div></div>
          </div>
          <input class="input-field" type="text" id="syncServerKey" placeholder="Firebase API Key ุฃู Server URL" style="margin-bottom:10px;"/>
          <div class="setting-row">
            <div><div class="setting-label">๐ข ูุนุฑูู ุงููุชุฌุฑ</div><div class="setting-desc">ููุณุชุฎุฏู ูุชูููุฒ ุจูุงูุงุชู ุนู ูุชุงุฌุฑ ุฃุฎุฑู</div></div>
          </div>
          <input class="input-field" type="text" id="syncStoreId" placeholder="ูุซุงู: store-123" style="margin-bottom:10px;"/>
          <div class="setting-row">
            <div><div class="setting-label">๐ถ ุงููุฒุงููุฉ ุนูุฏ ุงููุทุงุน ุงูุฅูุชุฑูุช</div><div class="setting-desc">Offline-first โ ุชูุฎุฒููู ุงูุจูุงูุงุช ูุญููุงู ูุชูุฑุณูู ุนูุฏ ุงูุงุชุตุงู</div></div>
            <label class="toggle-switch"><input type="checkbox" id="syncOfflineFirst" checked/><div class="toggle-track"><div class="toggle-thumb"></div></div></label>
          </div>
          <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;margin:14px 0;">
            <div style="background:var(--bg-dark);border-radius:var(--radius-sm);padding:12px;text-align:center;">
              <div style="font-size:1.3rem;">๐ฅ๏ธ</div>
              <div style="font-size:0.75rem;color:var(--text-secondary);margin:4px 0;">ูุฐุง ุงูุฌูุงุฒ</div>
              <div id="syncThisDevice" style="font-size:0.7rem;color:var(--success);">โ ูุชุตู</div>
            </div>
            <div style="background:var(--bg-dark);border-radius:var(--radius-sm);padding:12px;text-align:center;opacity:0.5;">
              <div style="font-size:1.3rem;">๐ฅ๏ธ</div>
              <div style="font-size:0.75rem;color:var(--text-secondary);margin:4px 0;">ุฌูุงุฒ 2</div>
              <div style="font-size:0.7rem;color:var(--text-secondary);">โ ุบูุฑ ูุฑุจูุท</div>
            </div>
            <div style="background:var(--bg-dark);border-radius:var(--radius-sm);padding:12px;text-align:center;opacity:0.5;">
              <div style="font-size:1.3rem;">๐ฅ๏ธ</div>
              <div style="font-size:0.75rem;color:var(--text-secondary);margin:4px 0;">ุฌูุงุฒ 3</div>
              <div style="font-size:0.7rem;color:var(--text-secondary);">โ ุบูุฑ ูุฑุจูุท</div>
            </div>
          </div>
          <button class="btn btn-primary" onclick="testSync()" style="width:100%;">๐ ุงุฎุชุจุงุฑ ุงูุงุชุตุงู</button>
        </div>
        <div style="margin-top:18px;padding:12px 16px;background:rgba(245,158,11,0.08);border:1px solid rgba(245,158,11,0.3);border-radius:var(--radius-sm);">
          <div style="font-size:0.78rem;color:var(--warning);font-weight:700;margin-bottom:4px;">โ๏ธ ููุงุญุธุฉ ูููุทููุฑ</div>
          <div style="font-size:0.75rem;color:var(--text-secondary);line-height:1.6;">ูุฐู ุงูุฎุงุตูุฉ ุชุชุทูุจ ุฅุนุฏุงุฏ ุฎุงุฏู Firebase ุฃู WebSocket backend. ููุชุทููุฑ ูุงูุชูุงูู ุงููุงูู ุชูุงุตู ูุน ุงููุทููุฑ ุนูู ูุงุชุณุงุจ: <b style="color:var(--primary-light);">0770044850</b></div>
        </div>
        <div class="modal-footer" style="margin-top:16px;">
          <button class="btn btn-success" onclick="saveSyncSettings()">๐พ ุญูุธ ุฅุนุฏุงุฏุงุช ุงููุฒุงููุฉ</button>
        </div>
      </div>
    </div>

    <!-- โโโ TAB: ุงูููุฒุงู โโโ -->
    <div class="tab-content" id="tab-scale">
      <div class="card">
        <h4 style="color:var(--primary-light);margin-bottom:16px;">โ๏ธ ุฑุจุท ุงูููุฒุงู ุงูุฅููุชุฑููู</h4>
        <div style="background:linear-gradient(135deg,var(--bg-dark),var(--bg-medium));border:1px solid var(--success);border-radius:var(--radius);padding:18px;margin-bottom:18px;">
          <div style="font-size:0.82rem;color:var(--text-secondary);line-height:1.7;">
            ุนูุฏ ุฑุจุท ุงูููุฒุงู ุงูุฅููุชุฑูููุ ุชุฏุฎู ูู ุนูููุงุช ุงููุฒู ูุงููุฏุงุฎูู ุชููุงุฆูุงู ูู ุฎุงูุฉ <b style="color:var(--primary-light);">โ๏ธ ูุฏุงุฎูู ุงูููุฒุงู</b> ูู ุฅุฏุงุฑุฉ ุงูุฃุนูุงู.
          </div>
        </div>

        <div class="setting-row">
          <div><div class="setting-label">โ๏ธ ุชูุนูู ุงูููุฒุงู ุงูุฅููุชุฑููู</div><div class="setting-desc">ุฑุจุท ุงูููุฒุงู ุจุงูุชุทุจูู ุชููุงุฆูุงู</div></div>
          <label class="toggle-switch"><input type="checkbox" id="scaleEnabled" onchange="toggleScaleSetting()"/><div class="toggle-track"><div class="toggle-thumb"></div></div></label>
        </div>

        <div id="scaleConfig" style="display:none;">
          <div class="setting-row">
            <div><div class="setting-label">๐ ููุน ุงูุงุชุตุงู</div></div>
            <select class="select-field" id="scaleConnectionType" style="width:180px;">
              <option value="serial">ูููุฐ ุชุณูุณูู (Serial COM)</option>
              <option value="usb">USB ูุจุงุดุฑ</option>
              <option value="bluetooth">Bluetooth</option>
              <option value="network">ุดุจูุฉ (TCP/IP)</option>
              <option value="manual">ูุฏูู (Manual)</option>
            </select>
          </div>
          <div class="setting-row">
            <div><div class="setting-label">๐ ูููุฐ ุงูุงุชุตุงู</div><div class="setting-desc">ูุซุงู: COM3 ุฃู /dev/ttyUSB0</div></div>
            <input class="input-field" type="text" id="scalePort" placeholder="COM3" style="width:180px;"/>
          </div>
          <div class="setting-row">
            <div><div class="setting-label">โก ูุนุฏู ุงูุฅุฑุณุงู (Baud Rate)</div></div>
            <select class="select-field" id="scaleBaudRate" style="width:180px;">
              <option value="9600">9600 (ุงูุฃูุซุฑ ุดููุนุงู)</option>
              <option value="4800">4800</option>
              <option value="19200">19200</option>
              <option value="38400">38400</option>
            </select>
          </div>
          <div class="setting-row">
            <div><div class="setting-label">๐ท๏ธ ูุญุฏุฉ ุงููุฒู</div></div>
            <select class="select-field" id="scaleUnit" style="width:180px;">
              <option value="ูุบ">ููููุบุฑุงู (ูุบ)</option>
              <option value="ุบ">ุบุฑุงู (ุบ)</option>
              <option value="ุท">ุทู</option>
            </select>
          </div>
          <div class="setting-row">
            <div><div class="setting-label">๐ฐ ุงูุณุนุฑ ุงูุงูุชุฑุงุถู / ูุบ</div><div class="setting-desc">ูููู ุชุบููุฑู ุนูุฏ ูู ุนูููุฉ</div></div>
            <input class="input-field" type="number" id="scaleDefaultPrice" placeholder="0.00" style="width:130px;"/>
          </div>
          <div style="margin:14px 0;padding:12px;background:var(--bg-dark);border-radius:var(--radius-sm);">
            <div style="font-size:0.8rem;color:var(--text-secondary);margin-bottom:8px;">๐ด ูุนุงููุฉ ุงูููุฒุงู โ ุขุฎุฑ ูุฑุงุกุฉ:</div>
            <div id="scalePreview" style="font-size:1.8rem;font-weight:900;color:var(--success);text-align:center;">โ๏ธ โ ูุบ</div>
            <div style="font-size:0.75rem;color:var(--text-secondary);text-align:center;margin-top:4px;" id="scalePreviewPrice">ุงูุณุนุฑ: โ</div>
          </div>
          <button class="btn btn-primary" onclick="testScaleConnection()" style="width:100%;margin-bottom:8px;">๐ ุงุฎุชุจุงุฑ ุงูุงุชุตุงู</button>
          <button class="btn btn-success" onclick="readScaleNow()" style="width:100%;">โ๏ธ ูุฑุงุกุฉ ุงููุฒู ุงูุขู</button>
        </div>

        <div style="margin-top:18px;padding:12px 16px;background:rgba(245,158,11,0.08);border:1px solid rgba(245,158,11,0.3);border-radius:var(--radius-sm);">
          <div style="font-size:0.78rem;color:var(--warning);font-weight:700;margin-bottom:4px;">โ๏ธ ููุงุญุธุฉ</div>
          <div style="font-size:0.75rem;color:var(--text-secondary);line-height:1.6;">ุงูุฑุจุท ุงูุชููุงุฆู ุงููุงูู ูุชุทูุจ ุฏุนู WebSerial API (ูุชููุฑ ูู Chrome/Edge). ูููู ุงุณุชุฎุฏุงู ูุถุน <b>ูุฏูู</b> ูุฅุฏุฎุงู ุจูุงูุงุช ุงูููุฒุงู ูุจุงุดุฑุฉ ูู ุฅุฏุงุฑุฉ ุงูุฃุนูุงู.</div>
        </div>
        <div class="modal-footer" style="margin-top:16px;">
          <button class="btn btn-success" onclick="saveScaleSettings()">๐พ ุญูุธ ุฅุนุฏุงุฏุงุช ุงูููุฒุงู</button>
        </div>
      </div>
    </div>

    <!-- โโโ TAB: ุงูุฅุดุนุงุฑุงุช โโโ -->
    <div class="tab-content" id="tab-notifs">
      <div class="card" style="margin-bottom:14px;">
        <div class="setting-row">
          <div>
            <div class="setting-label">๐ ุงูุฅุดุนุงุฑุงุช ุงูุนุงูุฉ</div>
            <div class="setting-desc">ุชูุนูู/ุฅููุงู ุฌููุน ุฅุดุนุงุฑุงุช ุงูุชุทุจูู</div>
          </div>
          <label class="toggle-switch"><input type="checkbox" id="notifEnabled" onchange="toggleAllNotifs(this.checked)"/><div class="toggle-track"><div class="toggle-thumb"></div></div></label>
        </div>
      </div>

      <!-- Notification Types -->
      <div class="card" id="notifTypesCard" style="margin-bottom:14px;">
        <h4 style="color:var(--primary-light);margin-bottom:14px;font-size:0.95rem;">๐ ุฃููุงุน ุงูุฅุดุนุงุฑุงุช</h4>

        <div class="setting-row" style="padding:10px 0;border-bottom:1px solid var(--border);">
          <div><div class="setting-label" style="font-size:0.9rem;">โฐ ุงูุชูุงุก ุตูุงุญูุฉ ููุชุฌ</div></div>
          <label class="toggle-switch"><input type="checkbox" id="notifExpiry" checked/><div class="toggle-track"><div class="toggle-thumb"></div></div></label>
        </div>
        <div class="setting-row" style="padding:10px 0;border-bottom:1px solid var(--border);">
          <div><div class="setting-label" style="font-size:0.9rem;">๐ ููุต ูููุฉ ููุชุฌ</div></div>
          <label class="toggle-switch"><input type="checkbox" id="notifLowStock" checked/><div class="toggle-track"><div class="toggle-thumb"></div></div></label>
        </div>
        <div class="setting-row" style="padding:10px 0;border-bottom:1px solid var(--border);">
          <div><div class="setting-label" style="font-size:0.9rem;">๐ณ ุฏูู ุงูุฒุจูู ูุตู ุฅูู 30 ููู</div></div>
          <label class="toggle-switch"><input type="checkbox" id="notifDebt30" checked/><div class="toggle-track"><div class="toggle-thumb"></div></div></label>
        </div>
        <div class="setting-row" style="padding:10px 0;border-bottom:1px solid var(--border);">
          <div><div class="setting-label" style="font-size:0.9rem;">๐พ ุฅุดุนุงุฑ ุชุฎุฒูู ูุงูู</div></div>
          <label class="toggle-switch"><input type="checkbox" id="notifStorage"/><div class="toggle-track"><div class="toggle-thumb"></div></div></label>
        </div>
        <div class="setting-row" style="padding:10px 0;border-bottom:1px solid var(--border);">
          <div><div class="setting-label" style="font-size:0.9rem;">๐ซ ููุงุฐ ูููุฉ ููุชุฌ</div></div>
          <label class="toggle-switch"><input type="checkbox" id="notifOutStock" checked/><div class="toggle-track"><div class="toggle-thumb"></div></div></label>
        </div>
        <div class="setting-row" style="padding:10px 0;border-bottom:1px solid var(--border);">
          <div><div class="setting-label" style="font-size:0.9rem;">๐ง ุฎูู ุชููู ูู ูุณู</div></div>
          <label class="toggle-switch"><input type="checkbox" id="notifTechError"/><div class="toggle-track"><div class="toggle-thumb"></div></div></label>
        </div>
        <div class="setting-row" style="padding:10px 0;border-bottom:1px solid var(--border);">
          <div><div class="setting-label" style="font-size:0.9rem;">๐ค ุฏุฎูู ูุณุชุฎุฏู ูุน ุงูุชูููุช</div></div>
          <label class="toggle-switch"><input type="checkbox" id="notifLogin" checked/><div class="toggle-track"><div class="toggle-thumb"></div></div></label>
        </div>
        <div class="setting-row" style="padding:10px 0;">
          <div><div class="setting-label" style="font-size:0.9rem;">๐ ุชุบููุฑ ุงูุฑูู ุงูุณุฑู</div></div>
          <label class="toggle-switch"><input type="checkbox" id="notifPwdChange" checked/><div class="toggle-track"><div class="toggle-thumb"></div></div></label>
        </div>
      </div>

      <!-- Notification Channels -->
      <div class="card" style="margin-bottom:14px;">
        <h4 style="color:var(--primary-light);margin-bottom:14px;font-size:0.95rem;">๐ก ูุณุงุฆู ุงุณุชูุงู ุงูุฅุดุนุงุฑุงุช</h4>

        <div class="setting-row" style="padding:10px 0;border-bottom:1px solid var(--border);">
          <div>
            <div class="setting-label" style="font-size:0.9rem;">๐ฑ ุฏุงุฎู ุงูุชุทุจูู</div>
            <div class="setting-desc">ุชุธูุฑ ูู ูุงุฌูุฉ ุงูุชุทุจูู ูุจุงุดุฑุฉ</div>
          </div>
          <label class="toggle-switch"><input type="checkbox" id="notifInApp" checked/><div class="toggle-track"><div class="toggle-thumb"></div></div></label>
        </div>
        <div class="setting-row" style="padding:10px 0;border-bottom:1px solid var(--border);">
          <div>
            <div class="setting-label" style="font-size:0.9rem;">๐ฒ ุฑุณุงูุฉ SMS</div>
            <div class="setting-desc">ุฅุฑุณุงู ุฑุณุงูุฉ ูุตูุฉ ูููุงุชู</div>
          </div>
          <label class="toggle-switch"><input type="checkbox" id="notifSMS"/><div class="toggle-track"><div class="toggle-thumb"></div></div></label>
        </div>
        <div id="notifSmsRow" style="display:none;padding:8px 0 12px;">
          <input class="input-field" type="tel" id="notifSmsPhone" placeholder="ุฑูู ุงููุงุชู ููุฅุดุนุงุฑุงุช SMS" style="max-width:280px;"/>
        </div>
        <div class="setting-row" style="padding:10px 0;">
          <div>
            <div class="setting-label" style="font-size:0.9rem;">๐ง ุจุฑูุฏ ุฅููุชุฑููู E-mail</div>
            <div class="setting-desc">ุฅุฑุณุงู ุฅุดุนุงุฑ ููุจุฑูุฏ ุงูุฅููุชุฑููู</div>
          </div>
          <label class="toggle-switch"><input type="checkbox" id="notifEmail"/><div class="toggle-track"><div class="toggle-thumb"></div></div></label>
        </div>
        <div id="notifEmailRow" style="display:none;padding:8px 0 12px;">
          <input class="input-field" type="email" id="notifEmailAddr" placeholder="ุงูุจุฑูุฏ ุงูุฅููุชุฑููู" style="max-width:280px;"/>
        </div>
      </div>

      <button class="btn btn-success" onclick="saveNotifSettings()">๐พ ุญูุธ ุฅุนุฏุงุฏุงุช ุงูุฅุดุนุงุฑุงุช</button>
    </div>

    <!-- โโโ TAB: ุญูู โโโ -->
    <div class="tab-content" id="tab-about">
      <div style="max-width:580px;margin:0 auto;padding:20px 0;">

        <!-- Main license card -->
        <div style="
          background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary) 50%, var(--secondary) 100%);
          border-radius: 20px;
          padding: 40px 32px;
          text-align: center;
          margin-bottom: 20px;
          box-shadow: 0 16px 48px var(--glow);
          position: relative;
          overflow: hidden;
        ">
          <!-- Decorative circles -->
          <div style="position:absolute;top:-40px;right:-40px;width:150px;height:150px;border-radius:50%;background:rgba(255,255,255,0.06);"></div>
          <div style="position:absolute;bottom:-30px;left:-30px;width:100px;height:100px;border-radius:50%;background:rgba(255,255,255,0.06);"></div>

          <!-- Logo -->
          <div style="font-family:Impact,Arial;font-size:3.5rem;font-weight:900;letter-spacing:2px;margin-bottom:4px;">
            <span style="color:#fff;">POS</span><span style="color:rgba(255,255,255,0.7);"> DZ</span>
          </div>
          <div style="color:rgba(255,255,255,0.8);font-size:0.95rem;margin-bottom:28px;letter-spacing:1px;">
            ูุธุงู ููุงุท ุงูุจูุน ุงูุฐูู
          </div>

          <!-- License status -->
          <div style="
            background:rgba(255,255,255,0.15);
            border:1px solid rgba(255,255,255,0.25);
            border-radius:14px;
            padding:20px 28px;
            display:inline-block;
            backdrop-filter:blur(10px);
            min-width:280px;
          ">
            <div style="font-size:0.82rem;color:rgba(255,255,255,0.7);margin-bottom:6px;letter-spacing:0.5px;">๐ ุญุงูุฉ ุงูุชุฑุฎูุต</div>
            <div style="color:#4ADE80;font-weight:900;font-size:1.1rem;margin-bottom:14px;">โ ุงูุจุฑูุงูุฌ ููุนูู</div>
            <div style="display:flex;justify-content:center;gap:28px;">
              <div>
                <div style="font-size:0.72rem;color:rgba(255,255,255,0.6);">ุงูุฅุตุฏุงุฑ</div>
                <div style="font-size:1.3rem;font-weight:900;color:#fff;">3.0.1</div>
              </div>
              <div style="width:1px;background:rgba(255,255,255,0.2);"></div>
              <div>
                <div style="font-size:0.72rem;color:rgba(255,255,255,0.6);">ุชุงุฑูุฎ ุงูุฅุตุฏุงุฑ</div>
                <div style="font-size:1.3rem;font-weight:900;color:#fff;">2026</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Developer card -->
        <div style="
          background: var(--bg-card);
          border: 1px solid var(--border);
          border-radius: 16px;
          padding: 24px 28px;
          margin-bottom: 16px;
          display: flex;
          align-items: center;
          gap: 20px;
        ">
          <div style="
            width:56px;height:56px;border-radius:50%;
            background:linear-gradient(135deg,var(--primary),var(--secondary));
            display:flex;align-items:center;justify-content:center;
            font-size:1.6rem;flex-shrink:0;
          ">๐จโ๐ป</div>
          <div style="flex:1;">
            <div style="font-size:0.8rem;color:var(--text-secondary);margin-bottom:4px;">ุงููุทูุฑ</div>
            <div style="font-size:1rem;font-weight:700;color:var(--text-primary);margin-bottom:6px;">
              ุดุฑูุฉ: ุจูุณ ุฏูุฒุงุฏ &nbsp;|&nbsp; ุจ.ุญูุฒุฉ
            </div>
            <div style="display:flex;align-items:center;gap:8px;">
              <span style="background:rgba(37,211,102,0.15);border:1px solid rgba(37,211,102,0.3);
                border-radius:8px;padding:4px 12px;font-size:0.85rem;color:#25D366;font-weight:700;">
                ๐ฑ ูุงุชุณุงุจ
              </span>
              <span style="font-size:1rem;font-weight:900;color:var(--primary-light);">0770044850</span>
            </div>
          </div>
        </div>

        <!-- Footer -->
        <div style="text-align:center;color:var(--text-secondary);font-size:0.82rem;padding:8px 0;">
          2026 ุจูุณ ุฏูุฒุงุฏ &nbsp;โ&nbsp; ุฌููุน ุงูุญููู ูุญููุธุฉ ยฎ
        </div>

      </div>
    </div>

  </div>
</div>

<!-- Sidebar โ labels only, no icons -->
<div class="sidebar-overlay" id="sidebarOverlay" onclick="closeSidebar()"></div>
<div class="sidebar" id="sidebar">
  <div class="sidebar-header">
    <div class="sidebar-brand">POS DZ</div>
    <div class="sidebar-user" id="sidebarUser"></div>
  </div>
  <nav class="sidebar-nav">
    <a class="nav-item" href="sale.html">
      <span class="nav-label" data-nav="navSale">ูุงุฌูุฉ ุงูุจูุน</span>
    </a>
    <a class="nav-item" href="inventory.html" data-role="admin,manager">
      <span class="nav-label" data-nav="navInventory">ุฅุฏุงุฑุฉ ุงููุฎุฒูู</span>
    </a>
    <a class="nav-item" href="customers.html" data-role="admin,manager,seller">
      <span class="nav-label" data-nav="navCustomers">ุฅุฏุงุฑุฉ ุงูุฒุจุงุฆู</span>
    </a>
    <a class="nav-item" href="reports.html" data-role="admin,manager">
      <span class="nav-label" data-nav="navReports">ุฅุฏุงุฑุฉ ุงูุฃุนูุงู</span>
    </a>
    <a class="nav-item" href="users.html" data-role="admin">
      <span class="nav-label" data-nav="navUsers">ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู</span>
    </a>
    <a class="nav-item" href="suppliers.html" data-role="admin,manager">
      <span class="nav-label" data-nav="navSuppliers">ุฅุฏุงุฑุฉ ุงูููุฒุนูู</span>
    </a>
    <a class="nav-item" href="settings.html" data-role="admin,manager">
      <span class="nav-label" data-nav="navSettings">ุงูุฅุนุฏุงุฏุงุช ุงูุนุงูุฉ</span>
    </a>
    <div class="nav-item danger" onclick="doLogout()">
      <span class="nav-label" data-nav="navLogout">ุฅุบูุงู ุงูุชุทุจูู</span>
    </div>
  </nav>
  <div class="sidebar-footer">POS DZ v6.0.0 | 2026 ุจูุณ ุฏูุฒุงุฏ ยฎ</div>
</div>
<div id="toast-container"></div>
<script src="app.js"></script>
<script>
'use strict';

let currentFontSize = 15;
let currentAccent   = 'blue_purple';
let currentBg       = 'dark';

// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
// TRANSLATIONS SYSTEM
// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
const I18N = {
  ar: {
    pageTitle:'โ๏ธ ุงูุฅุนุฏุงุฏุงุช ุงูุนุงูุฉ',
    tabBtnProgram:'๐ป ุงูุจุฑูุงูุฌ', tabBtnStore:'๐ช ุงููุชุฌุฑ', tabBtnPrint:'๐จ๏ธ ุงูุทุจุงุนุฉ',
    tabBtnSystem:'๐ง ุงููุธุงู', tabBtnNotifs:'๐ ุงูุฅุดุนุงุฑุงุช', tabBtnAbout:'โน๏ธ ุญูู',
    backBtn:'โ ุฑุฌูุน', saveBtn:'๐พ ุญูุธ ุงูุจูุงูุงุช',
    labelDate:'๐ ุตูุบุฉ ุงูุชุงุฑูุฎ', labelCurrency:'๐ฐ ุฑูุฒ ุงูุนููุฉ',
    labelLang:'๐ ูุบุฉ ุงูุจุฑูุงูุฌ', labelLangDesc:'ุชุทุจูู ููุฑู ุนูู ูู ุตูุญุงุช ุงูุชุทุจูู',
    labelFont:'๐ค ุฎุท ุงูุชุทุจูู', labelFontSize:'๐ก ุญุฌู ุงูุฎุท',
    labelAccentColor:'๐จ ููู ุงูุฃููููุงุช ูุงูุฃุฒุฑุงุฑ', labelBgMode:'๐ ูุถุน ุงูุฎูููุฉ',
    bgDark:'ุฏุงูู โ Mode nuit', bgLight:'ูุงุชุญ โ Mode jour',
    labelSoundAdd:'๐ ุตูุช ุฅุถุงูุฉ ุงูููุชุฌ', labelSoundSell:'๐ ุตูุช ุฅุชูุงู ุงูุจูุน',
    labelSoundBtn:'๐ ุตูุช ุงูุฃุฒุฑุงุฑ',
    labelBarcode:'๐ท ุชูุนูู ูุงุฑุฆ ุงูุจุงุฑููุฏ',
    labelBarcodeDesc:'ุฌูุงุฒ ุงูุจุงุฑููุฏ ูุถูู ุงูููุชุฌุงุช ุชููุงุฆูุงู ุนูุฏ ุงูุชูุนูู',
    labelBarcodeAuto:'๐ท ุญุฌุฒ ุงูููุชุฌุงุช ุชููุงุฆูุงู',
    labelTouchKb:'โจ๏ธ ุงูููุจูุฑุฏ ุงูุงูุชุฑุงุถู (ุดุงุดุงุช ุงูููุณ)',
    labelTouchKbDesc:'ุฒุฑ ุนูู ุฌุงูุจ ุงูุดุงุดุฉ ูุงุจู ููุณุญุจ',
    navSale:'ูุงุฌูุฉ ุงูุจูุน', navInventory:'ุฅุฏุงุฑุฉ ุงููุฎุฒูู',
    navCustomers:'ุฅุฏุงุฑุฉ ุงูุฒุจุงุฆู', navReports:'ุฅุฏุงุฑุฉ ุงูุฃุนูุงู',
    navUsers:'ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู', navSuppliers:'ุฅุฏุงุฑุฉ ุงูููุฒุนูู',
    navSettings:'ุงูุฅุนุฏุงุฏุงุช ุงูุนุงูุฉ', navLogout:'ุฅุบูุงู',
  },
  fr: {
    pageTitle:'โ๏ธ Paramรจtres gรฉnรฉraux',
    tabBtnProgram:'๐ป Programme', tabBtnStore:'๐ช Boutique', tabBtnPrint:'๐จ๏ธ Impression',
    tabBtnSystem:'๐ง Systรจme', tabBtnNotifs:'๐ Notifications', tabBtnAbout:'โน๏ธ ร propos',
    backBtn:'โ Retour', saveBtn:'๐พ Enregistrer',
    labelDate:'๐ Format de date', labelCurrency:'๐ฐ Devise',
    labelLang:'๐ Langue', labelLangDesc:'Appliquรฉ immรฉdiatement ร toute l\'application',
    labelFont:'๐ค Police', labelFontSize:'๐ก Taille de police',
    labelAccentColor:'๐จ Couleur des icรดnes', labelBgMode:'๐ Mode de fond',
    bgDark:'Sombre โ Mode nuit', bgLight:'Clair โ Mode jour',
    labelSoundAdd:'๐ Son ajout produit', labelSoundSell:'๐ Son vente terminรฉe',
    labelSoundBtn:'๐ Son des boutons',
    labelBarcode:'๐ท Activer lecteur code-barres',
    labelBarcodeDesc:'Le scanner ajoute les produits automatiquement',
    labelBarcodeAuto:'๐ท Ajout automatique par scanner',
    labelTouchKb:'โจ๏ธ Clavier tactile (รฉcrans tactiles)',
    labelTouchKbDesc:'Bouton sur le cรดtรฉ de l\'รฉcran, dรฉplaรงable',
    navSale:'Interface vente', navInventory:'Gestion stock',
    navCustomers:'Clients', navReports:'Activitรฉ commerciale',
    navUsers:'Utilisateurs', navSuppliers:'Fournisseurs',
    navSettings:'Paramรจtres', navLogout:'Dรฉconnexion',
  },
  en: {
    pageTitle:'โ๏ธ General Settings',
    tabBtnProgram:'๐ป Program', tabBtnStore:'๐ช Store', tabBtnPrint:'๐จ๏ธ Printing',
    tabBtnSystem:'๐ง System', tabBtnNotifs:'๐ Notifications', tabBtnAbout:'โน๏ธ About',
    backBtn:'โ Back', saveBtn:'๐พ Save',
    labelDate:'๐ Date format', labelCurrency:'๐ฐ Currency',
    labelLang:'๐ Language', labelLangDesc:'Applied immediately across all pages',
    labelFont:'๐ค Font', labelFontSize:'๐ก Font size',
    labelAccentColor:'๐จ Icon & button color', labelBgMode:'๐ Background mode',
    bgDark:'Dark โ Night Mode', bgLight:'Light โ Day Mode',
    labelSoundAdd:'๐ Product add sound', labelSoundSell:'๐ Sale complete sound',
    labelSoundBtn:'๐ Button sounds',
    labelBarcode:'๐ท Enable barcode reader',
    labelBarcodeDesc:'Scanner adds products automatically when enabled',
    labelBarcodeAuto:'๐ท Auto-add by barcode scanner',
    labelTouchKb:'โจ๏ธ Touch keyboard (touch screens)',
    labelTouchKbDesc:'Side button, draggable',
    navSale:'Sale', navInventory:'Inventory',
    navCustomers:'Customers', navReports:'Business',
    navUsers:'Users', navSuppliers:'Suppliers',
    navSettings:'Settings', navLogout:'Logout',
  }
};

function applyTranslation(lang) {
  const t = I18N[lang] || I18N.ar;
  const dir = lang === 'ar' ? 'rtl' : 'ltr';
  document.documentElement.lang = lang;
  document.documentElement.dir = dir;

  // Page elements
  const pageTitle = document.getElementById('pageTitle');
  if (pageTitle) pageTitle.textContent = t.pageTitle;
  const backBtn = document.getElementById('backBtn');
  if (backBtn) backBtn.textContent = t.backBtn;

  // Tab buttons
  ['tabBtnProgram','tabBtnStore','tabBtnPrint','tabBtnSystem','tabBtnNotifs','tabBtnAbout'].forEach(id => {
    const el = document.getElementById(id);
    if (el && t[id]) el.textContent = t[id];
  });

  // All data-i18n elements
  document.querySelectorAll('[data-i18n]').forEach(el => {
    const k = el.dataset.i18n;
    if (t[k] !== undefined) el.textContent = t[k];
  });

  // Sidebar nav labels
  document.querySelectorAll('[data-nav]').forEach(el => {
    const k = el.dataset.nav;
    if (t[k] !== undefined) el.textContent = t[k];
  });

  // Save buttons
  document.querySelectorAll('[data-i18n="saveBtn"]').forEach(el => {
    el.textContent = t.saveBtn;
  });

  // Auto currency for AR
  if (lang === 'ar') {
    const cur = document.getElementById('currency');
    if (cur && (cur.value === 'DA' || !cur.value)) cur.value = 'ุฏุฌ';
  }

  // Persist to localStorage for other pages
  localStorage.setItem('posdz_lang', lang);
}

function onLangChange(lang) {
  applyTranslation(lang);
}

// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
// THEME: ACCENT COLOR (only primary colors, NO background)
// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
function selectAccent(theme) {
  currentAccent = theme;
  document.querySelectorAll('.theme-dot').forEach(d => {
    d.classList.toggle('active', d.dataset.theme === theme);
  });
  // Use new data-accent attribute (doesn't touch bg)
  document.documentElement.setAttribute('data-accent', theme);
  document.documentElement.setAttribute('data-theme', theme === 'blue_purple' ? '' : theme);
}

// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
// THEME: BACKGROUND MODE (only bg/text, NO primary)
// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
function selectBg(mode) {
  currentBg = mode;
  document.documentElement.setAttribute('data-bg', mode);
  const btnD = document.getElementById('btnBgDark');
  const btnL = document.getElementById('btnBgLight');
  if (btnD) { btnD.classList.toggle('sel-dark', mode === 'dark'); btnD.classList.remove('sel-light'); }
  if (btnL) { btnL.classList.toggle('sel-light', mode === 'light'); btnL.classList.remove('sel-dark'); }
  // Show accent color DOTS only in light mode โ dark mode = fixed purple
  const colorDots = document.getElementById('accentDotsRow');
  if (colorDots) colorDots.style.display = mode === 'light' ? '' : 'none';
  if (mode === 'dark') selectAccent('blue_purple');
}

// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
// FONT
// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
function changeFontSize(delta) {
  currentFontSize = Math.max(11, Math.min(20, currentFontSize + delta));
  document.getElementById('fontSizeDisplay').textContent = currentFontSize;
  document.documentElement.style.fontSize = currentFontSize + 'px';
}

function applyFontPreview(fontName) {
  document.body.style.fontFamily = `'${fontName}', 'Cairo', sans-serif`;
  let link = document.getElementById('dyn-font');
  if (!link) {
    link = document.createElement('link');
    link.id = 'dyn-font';
    link.rel = 'stylesheet';
    document.head.appendChild(link);
  }
  const fontMap = {
    'Cairo':'Cairo', 'Tajawal':'Tajawal', 'Amiri':'Amiri',
    'Almarai':'Almarai', 'IBM Plex Sans Arabic':'IBM+Plex+Sans+Arabic'
  };
  link.href = `https://fonts.googleapis.com/css2?family=${fontMap[fontName]||'Cairo'}:wght@400;700;900&display=swap`;
}

// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
// PRINTER
// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
function openPrinterDialog(type) {
  const paperSize = document.getElementById('paperSize')?.value || '80mm';
  const widthMap  = {'58mm':'54mm','80mm':'76mm','A5':'148mm','A4':'210mm'};
  const pw = type === 'invoice' ? (widthMap[paperSize] || '76mm') : '60mm';
  const isInvoice = type === 'invoice';

  const pageContent = isInvoice
    ? `<div style="text-align:center;padding:15px;font-family:Arial;">
        <h2>ุทุจุงุนุฉ ุชุฌุฑูุจูุฉ โ ูุงุชูุฑุฉ</h2>
        <p>ูุฐู ุทุจุงุนุฉ ุงุฎุชุจุงุฑูุฉ<br>ุงุฎุชุฑ ุงูุทุงุจุนุฉ ุงูููุงุณุจุฉ ููููุงุชูุฑ</p>
        <hr/><p style="font-size:13px;font-weight:bold;">POS DZ โ ูุงุชูุฑุฉ ุชุฌุฑูุจูุฉ</p>
        <p>ุงูููุชุฌ ร ุงููููุฉ = ุงููุฌููุน</p>
        <p style="font-size:18px;font-weight:900;">ุงูุฅุฌูุงูู: 500.00 ุฏุฌ</p>
       </div>`
    : `<div style="text-align:center;padding:10px;font-family:Arial;width:58mm;">
        <p style="font-weight:900;font-size:13px;">POS DZ</p>
        <p style="font-weight:900;">ุณูุฑ 1ูุบ</p>
        <p style="font-family:monospace;">6191234567890</p>
        <p style="font-size:16px;font-weight:900;">150.00 ุฏุฌ</p>
       </div>`;

  const html = `<!DOCTYPE html><html dir="rtl"><head><meta charset="UTF-8">
    <style>
      @page { size:${pw} auto; margin:4mm; }
      body { font-family:Arial; color:#000; background:#fff; }
      @media print { * { -webkit-print-color-adjust:exact; print-color-adjust:exact; } }
    </style></head><body>${pageContent}</body></html>`;

  _silentPrint(html);

  // Ask user to name the chosen printer โ custom dialog instead of prompt
  setTimeout(async () => {
    const label = isInvoice ? 'ุงูุชุจ ุงุณู ุทุงุจุนุฉ ุงูููุงุชูุฑ ุงูุชู ุงุฎุชุฑุชูุง:' : 'ุงูุชุจ ุงุณู ุทุงุจุนุฉ ุงูุจุงุฑููุฏ ุงูุชู ุงุฎุชุฑุชูุง:';
    const chosen = await _inputDialog(label, 'ุงูุทุงุจุนุฉ ุงูุงูุชุฑุงุถูุฉ');
    if (chosen && chosen.trim()) {
      const nameEl = document.getElementById(isInvoice ? 'printerInvoiceName' : 'printerBarcodeName');
      if (nameEl) nameEl.textContent = chosen.trim();
      const cardEl = document.getElementById(isInvoice ? 'printerInvoiceCard' : 'printerBarcodeCard');
      if (cardEl) cardEl.classList.add('selected');
    }
  }, 500);
}

function testPrintInvoice() {
  openPrinterDialog('invoice');
}

// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
// LIVE INVOICE PREVIEW
// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
async function updateInvoicePreview() {
  const sName  = document.getElementById('storeName')?.value    || await getSetting('storeName')    || 'ุงุณู ุงููุชุฌุฑ';
  const sPhone = document.getElementById('storePhone')?.value   || await getSetting('storePhone')   || '0700 00 00 00';
  const sAddr  = document.getElementById('storeAddress')?.value || await getSetting('storeAddress') || 'ุงูุนููุงู';
  const sWelc  = document.getElementById('storeWelcome')?.value || await getSetting('storeWelcome') || 'ุดูุฑุงู ูุฒูุงุฑุชูู';
  const cur    = document.getElementById('currency')?.value     || await getSetting('currency')     || 'ุฏุฌ';
  const ps     = document.getElementById('paperSize')?.value    || '80mm';

  const showName    = document.getElementById('printName')?.checked;
  const showPhone   = document.getElementById('printPhone')?.checked;
  const showAddr    = document.getElementById('printAddress')?.checked;
  const showWelcome = document.getElementById('printWelcome')?.checked;
  const showBarcode = document.getElementById('printBarcode')?.checked;

  // Line width per paper
  const lw = {'58mm':30,'80mm':40,'A5':54,'A4':68}[ps] || 40;
  const H  = 'โ'.repeat(lw);
  const L  = 'โ'.repeat(lw);

  const now   = new Date();
  const dStr  = now.toLocaleDateString('ar-DZ');
  const tStr  = now.toLocaleTimeString('ar-DZ',{hour:'2-digit',minute:'2-digit'});

  const ctr = (txt) => {
    const pad = Math.max(0, Math.floor((lw - txt.length) / 2));
    return ' '.repeat(pad) + txt;
  };

  const lines = [];
  lines.push(`ูุงุชูุฑุฉ: #001        ${dStr} ${tStr}`);
  lines.push(H);
  if (showName)                    lines.push(ctr(sName));
  if (showPhone)                   lines.push(ctr('๐ ' + sPhone));
  if (showAddr)                    lines.push(ctr('๐ ' + sAddr));
  if (showName||showPhone||showAddr) lines.push(L);
  lines.push('ุงูููุชุฌ            ู   ุงูุณุนุฑ  ุงููุฌููุน');
  lines.push(L);
  lines.push('ุณูุฑ 1ูุบ           2   150.00  300.00');
  lines.push('ูุฑููุฉ              1   200.00  200.00');
  lines.push('ุฒูุช                3    95.00  285.00');
  lines.push(H);
  lines.push(`ุงูุฅุฌูุงูู:               785.00 ${cur}`);
  lines.push(H);
  if (showWelcome && sWelc) lines.push(ctr(sWelc));
  if (showBarcode)          lines.push(ctr('||||| #001 |||||'));

  document.getElementById('invoicePreview').textContent = lines.join('\n');
}

// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
// LIVE BARCODE LABEL PREVIEW
// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
async function updateBarcodePreview() {
  const storeName = document.getElementById('storeName')?.value || await getSetting('storeName') || 'POS DZ';
  const currency  = document.getElementById('currency')?.value  || await getSetting('currency')  || 'ุฏุฌ';
  const font      = document.getElementById('barcodeFont')?.value || 'Cairo';
  const btype     = document.getElementById('barcodeType')?.value || 'CODE128';

  const showStore = document.getElementById('barcodeShowStore')?.checked;
  const showName  = document.getElementById('barcodeShowName')?.checked;
  const showPrice = document.getElementById('barcodeShowPrice')?.checked;

  const sn = document.getElementById('bpStoreName');
  const pn = document.getElementById('bpProductName');
  const pr = document.getElementById('bpPrice');

  if (sn) { sn.textContent = showStore ? storeName : ''; sn.style.fontFamily = font; }
  if (pn) { pn.style.display = showName ? '' : 'none'; pn.style.fontFamily = font; }
  if (pr) { pr.style.display = showPrice ? '' : 'none'; pr.textContent = `150.00 ${currency}`; pr.style.fontFamily = font; }

  // Render barcode visuals based on type
  const barsEl = document.getElementById('bpBars');
  const codeEl = document.getElementById('bpCode');
  if (!barsEl) return;
  barsEl.innerHTML = '';
  barsEl.style.display = 'flex'; // reset

  if (btype === 'QR') {
    // QR: render a grid
    barsEl.style.display = 'block';
    barsEl.style.height = 'auto';
    const grid = document.createElement('div');
    grid.style.cssText = 'display:grid;grid-template-columns:repeat(12,5px);gap:1px;width:fit-content;margin:0 auto;';
    const pattern = [1,0,1,1,0,1,0,1,1,0,1,0,
                     1,1,0,0,1,0,1,0,0,1,0,1,
                     1,0,1,0,0,1,1,0,1,0,1,0,
                     0,1,1,0,1,0,0,1,0,1,1,0,
                     1,0,0,1,1,0,1,0,1,0,0,1,
                     0,1,0,0,1,1,0,1,0,0,1,0,
                     1,1,1,0,0,0,1,1,1,0,0,1,
                     0,0,1,1,0,1,0,0,1,1,0,0,
                     1,0,1,0,1,0,1,0,1,0,1,0,
                     0,1,0,1,0,1,0,1,0,1,0,1,
                     1,0,0,1,1,0,0,1,1,0,0,1,
                     0,1,1,0,0,1,1,0,0,1,1,0];
    pattern.forEach(v => {
      const cell = document.createElement('div');
      cell.style.cssText = `width:5px;height:5px;background:${v?'#000':'#fff'};border:0.5px solid #eee;`;
      grid.appendChild(cell);
    });
    barsEl.appendChild(grid);
    if (codeEl) codeEl.textContent = '6191234567890';
  } else if (btype === 'EAN13') {
    // EAN-13: tall narrow bars with guard bars
    barsEl.style.height = '45px';
    const code = '6191234567890';
    for (let i = 0; i < code.length * 3 + 6; i++) {
      const c  = code.charCodeAt(i % code.length);
      const isGuard = i < 3 || i > code.length * 3 + 2;
      const sp = !isGuard && (c + i * 3) % 5 === 0;
      const w  = isGuard ? 2 : ((c + i) % 3 === 0 ? 3 : 2);
      const h  = isGuard ? 45 : 38;
      const bar = document.createElement('div');
      Object.assign(bar.style, { width:w+'px', height:h+'px', background:sp?'#fff':'#000', display:'inline-block', flexShrink:'0' });
      barsEl.appendChild(bar);
    }
    if (codeEl) codeEl.textContent = '6 191234 567890';
  } else if (btype === 'EAN8') {
    barsEl.style.height = '40px';
    const code = '61912345';
    for (let i = 0; i < code.length * 4 + 6; i++) {
      const c  = code.charCodeAt(i % code.length);
      const sp = (c + i * 3) % 5 === 0;
      const w  = (c + i) % 3 === 0 ? 3 : 2;
      const h  = 30 + ((c + i) % 10);
      const bar = document.createElement('div');
      Object.assign(bar.style, { width:w+'px', height:h+'px', background:sp?'#fff':'#000', display:'inline-block', flexShrink:'0' });
      barsEl.appendChild(bar);
    }
    if (codeEl) codeEl.textContent = '6191 2345';
  } else if (btype === 'UPCA') {
    barsEl.style.height = '45px';
    const code = '619123456789';
    for (let i = 0; i < code.length * 3 + 6; i++) {
      const c  = code.charCodeAt(i % code.length);
      const sp = (c + i * 3) % 5 === 0;
      const w  = (c + i) % 3 === 0 ? 3 : 2;
      const h  = 42;
      const bar = document.createElement('div');
      Object.assign(bar.style, { width:w+'px', height:h+'px', background:sp?'#fff':'#000', display:'inline-block', flexShrink:'0' });
      barsEl.appendChild(bar);
    }
    if (codeEl) codeEl.textContent = '6 19123 456789';
  } else {
    // CODE128 default โ variable height bars
    barsEl.style.height = '42px';
    const code = '6191234567890';
    for (let i = 0; i < code.length * 3 + 10; i++) {
      const c  = code.charCodeAt(i % code.length);
      const sp = (c + i * 3) % 5 === 0;
      const w  = (c + i) % 3 === 0 ? 3 : 2;
      const h  = 28 + ((c + i * 2) % 14);
      const bar = document.createElement('div');
      Object.assign(bar.style, { width:w+'px', height:h+'px', background:sp?'#fff':'#000', display:'inline-block', flexShrink:'0' });
      barsEl.appendChild(bar);
    }
    if (codeEl) codeEl.textContent = '6191234567890';
  }
}

// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
// INIT
// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
async function init() {
  requireRole(['admin', 'manager']);
  await initApp();
  await loadAllSettings();
  await loadSyncScaleSettings();
  await loadNotifSettings();
}

function switchTab(name) {
  document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
  document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
  const tabBtnIds = {
    'program':'tabBtnProgram','store':'tabBtnStore',
    'print':'tabBtnPrint','sync':'tabBtnSync','scale':'tabBtnScale',
    'system':'tabBtnSystem','notifs':'tabBtnNotifs','about':'tabBtnAbout'
  };
  const btnEl = document.getElementById(tabBtnIds[name]);
  if (btnEl) btnEl.classList.add('active');
  const tabEl = document.getElementById('tab-' + name);
  if (tabEl) tabEl.classList.add('active');
  if (name === 'print') {
    updateInvoicePreview();
    updateBarcodePreview();
  }
}

async function loadAllSettings() {
  const keys = [
    'dateFormat','currency','language','appFont',
    'soundAdd','soundSell','soundButtons',
    'barcodeReader','barcodeAuto','touchKeyboard',
    'storeName','storePhone','storeAddress','storeWelcome',
    'invoiceNumber','paperSize',
    'printLogo','printName','printPhone','printWelcome','printAddress','printBarcode',
    'barcodeShowStore','barcodeShowName','barcodeShowPrice',
    'barcodeType','barcodeFont','autoBackup',
    'notifEnabled','notifExpiry','notifLowStock','notifDebt30','notifStorage',
    'notifOutStock','notifTechError','notifLogin','notifPwdChange',
    'notifInApp','notifSMS','notifEmail'
  ];
  for (const key of keys) {
    try {
      const val = await getSetting(key);
      if (val === null || val === undefined) continue;
      const el = document.getElementById(key);
      if (!el) continue;
      if (el.type === 'checkbox') el.checked = (val === '1');
      else el.value = val;
    } catch(e) {}
  }

  // Font size
  currentFontSize = parseInt(await getSetting('fontSize')) || 15;
  document.getElementById('fontSizeDisplay').textContent = currentFontSize;
  document.documentElement.style.fontSize = currentFontSize + 'px';

  // Accent
  currentAccent = await getSetting('themeColor') || 'blue_purple';
  document.querySelectorAll('.theme-dot').forEach(d => {
    d.classList.toggle('active', d.dataset.theme === currentAccent);
  });
  document.documentElement.setAttribute('data-accent', currentAccent);
  document.documentElement.setAttribute('data-theme', currentAccent === 'blue_purple' ? '' : currentAccent);

  // Background
  currentBg = await getSetting('bgMode') || 'dark';
  document.documentElement.setAttribute('data-bg', currentBg);
  selectBg(currentBg); // update button styles

  // Language
  const lang = await getSetting('language') || localStorage.getItem('posdz_lang') || 'ar';
  const langEl = document.getElementById('language');
  if (langEl) langEl.value = lang;
  applyTranslation(lang);

  // Font
  const font = await getSetting('appFont') || 'Cairo';
  const fontEl = document.getElementById('appFont');
  if (fontEl) fontEl.value = font;
  applyFontPreview(font);

  // Logo
  const logo = await getSetting('storeLogo');
  if (logo) {
    const lp = document.getElementById('logoPreview');
    if (lp) { lp.src = logo; lp.style.display = 'block'; }
  }

  // Printer names
  const invP = await getSetting('printerInvoice');
  if (invP) { const el = document.getElementById('printerInvoiceName'); if (el) el.textContent = invP; }
  const barP = await getSetting('printerBarcode');
  if (barP) { const el = document.getElementById('printerBarcodeName'); if (el) el.textContent = barP; }

  // Initial previews
  await updateBarcodePreview();
}

// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
// SAVE
// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
async function saveSettings(section) {
  if (section === 'program') {
    await setSetting('dateFormat',    document.getElementById('dateFormat').value);
    await setSetting('currency',      document.getElementById('currency').value);
    const lang = document.getElementById('language').value;
    await setSetting('language',      lang);
    const font = document.getElementById('appFont').value;
    await setSetting('appFont',       font);
    await setSetting('fontSize',      String(currentFontSize));
    await setSetting('themeColor',    currentAccent);
    await setSetting('bgMode',        currentBg);
    await setSetting('soundAdd',      document.getElementById('soundAdd').checked ? '1':'0');
    await setSetting('soundSell',     document.getElementById('soundSell').checked ? '1':'0');
    await setSetting('soundButtons',  document.getElementById('soundButtons').checked ? '1':'0');
    await setSetting('barcodeReader', document.getElementById('barcodeReader').checked ? '1':'0');
    await setSetting('barcodeAuto',   document.getElementById('barcodeAuto').checked ? '1':'0');
    await setSetting('touchKeyboard', document.getElementById('touchKeyboard').checked ? '1':'0');
    applyTranslation(lang);
    applyFontPreview(font);
    // Apply new dual-attribute theme system
    document.documentElement.setAttribute('data-accent', currentAccent);
    document.documentElement.setAttribute('data-theme', currentAccent === 'blue_purple' ? '' : currentAccent);
    document.documentElement.setAttribute('data-bg', currentBg);
  }
  if (section === 'store') {
    await setSetting('storeName',    document.getElementById('storeName').value);
    await setSetting('storePhone',   document.getElementById('storePhone').value);
    await setSetting('storeAddress', document.getElementById('storeAddress').value);
    await setSetting('storeWelcome', document.getElementById('storeWelcome').value);
    const hdr = document.getElementById('headerStoreName');
    if (hdr) hdr.textContent = document.getElementById('storeName').value;
  }
  if (section === 'print') {
    await setSetting('invoiceNumber', document.getElementById('invoiceNumber').value);
    await setSetting('paperSize',     document.getElementById('paperSize').value);
    await setSetting('printLogo',     document.getElementById('printLogo').checked ? '1':'0');
    await setSetting('printName',     document.getElementById('printName').checked ? '1':'0');
    await setSetting('printPhone',    document.getElementById('printPhone').checked ? '1':'0');
    await setSetting('printWelcome',  document.getElementById('printWelcome').checked ? '1':'0');
    await setSetting('printAddress',  document.getElementById('printAddress').checked ? '1':'0');
    await setSetting('printBarcode',  document.getElementById('printBarcode').checked ? '1':'0');
    const invName = document.getElementById('printerInvoiceName')?.textContent;
    if (invName) await setSetting('printerInvoice', invName);
  }
  if (section === 'barcode') {
    await setSetting('barcodeShowStore', document.getElementById('barcodeShowStore').checked ? '1':'0');
    await setSetting('barcodeShowName',  document.getElementById('barcodeShowName').checked ? '1':'0');
    await setSetting('barcodeShowPrice', document.getElementById('barcodeShowPrice').checked ? '1':'0');
    await setSetting('barcodeType',      document.getElementById('barcodeType').value);
    await setSetting('barcodeFont',      document.getElementById('barcodeFont').value);
    const barName = document.getElementById('printerBarcodeName')?.textContent;
    if (barName) await setSetting('printerBarcode', barName);
  }
  if (section === 'system') {
    await setSetting('autoBackup', document.getElementById('autoBackup').checked ? '1':'0');
  }
  toast('โ ุชู ุงูุญูุธ ุจูุฌุงุญ', 'success');
}

// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
// LOGO
// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
function loadLogo(input) {
  const file = input.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = async (e) => {
    const data = e.target.result;
    await setSetting('storeLogo', data);
    const lp = document.getElementById('logoPreview');
    if (lp) { lp.src = data; lp.style.display = 'block'; }
    toast('ุชู ุชุญููู ุงูุดุนุงุฑ โ', 'success');
  };
  reader.readAsDataURL(file);
}

async function deleteLogo() {
  await setSetting('storeLogo', '');
  const lp = document.getElementById('logoPreview');
  if (lp) { lp.src = ''; lp.style.display = 'none'; }
  toast('ุชู ุญุฐู ุงูุดุนุงุฑ', 'success');
}

// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
// SYSTEM ACTIONS
// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
async function partialClear() {
  if (!await customConfirmAsync('โ๏ธ ุณูุชู ูุณุญ ุงููุจูุนุงุชุ ุงูุฏูููุ ูุณุฌู ุงูุนูููุงุช. ูู ุชุฑูุฏ ุงููุชุงุจุนุฉุ')) return;
  if (!await customConfirmAsync('โ๏ธ ุชุฃููุฏ ุฃุฎูุฑ: ูุฐุง ุงูุฅุฌุฑุงุก ูุง ูููู ุงูุชุฑุงุฌุน ุนูู!')) return;
  for (const store of ['sales','saleItems','debts','logs']) {
    const all = await dbGetAll(store);
    for (const item of all) await dbDelete(store, item.id);
  }
  await resetDailyCounter();
  toast('โ ุชู ุงููุณุญ ุงูุฌุฒุฆู', 'success');
}

async function fullClear() {
  if (!await customConfirmAsync('๐จ ุชุญุฐูุฑ: ุณูุชู ูุณุญ ูู ุงูุจูุงูุงุช ููุงุฆูุงู!')) return;
  if (!await customConfirmAsync('๐จ ุชุฃููุฏ ุฃุฎูุฑ: ูุฐุง ุงูุฅุฌุฑุงุก ูุง ูููู ุงูุชุฑุงุฌุน ุนูู!')) return;
  for (const s of ['products','families','customers','suppliers','sales','saleItems','debts','logs']) {
    const all = await dbGetAll(s);
    for (const item of all) await dbDelete(s, item.id);
  }
  await resetDailyCounter();
  toast('โ๏ธ ุชู ุงููุณุญ ุงูููู', 'warning', 4000);
}


// โโ Sync Settings โโ
function toggleSync() {
  const enabled = document.getElementById('syncEnabled').checked;
  document.getElementById('syncConfig').style.display = enabled ? 'block' : 'none';
}
async function saveSyncSettings() {
  await setSetting('syncEnabled', document.getElementById('syncEnabled').checked ? '1' : '0');
  await setSetting('syncServerKey', document.getElementById('syncServerKey').value);
  await setSetting('syncStoreId', document.getElementById('syncStoreId').value);
  await setSetting('syncOfflineFirst', document.getElementById('syncOfflineFirst').checked ? '1' : '0');
  toast('โ ุชู ุญูุธ ุฅุนุฏุงุฏุงุช ุงููุฒุงููุฉ', 'success');
}
async function testSync() {
  toast('๐ ุฌุงุฑู ุงุฎุชุจุงุฑ ุงูุงุชุตุงู...', 'info', 2000);
  setTimeout(() => toast('โ๏ธ ุงููุฒุงููุฉ ุชุญุชุงุฌ ุฅุนุฏุงุฏ ุฎุงุฏู โ ุชูุงุตู ูุน ุงููุทููุฑ', 'warning', 3000), 2000);
}

// โโ Notification Settings โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
function toggleAllNotifs(enabled) {
  document.getElementById('notifTypesCard').style.opacity = enabled ? '1' : '0.4';
  document.getElementById('notifTypesCard').style.pointerEvents = enabled ? '' : 'none';
}
document.getElementById('notifSMS')?.addEventListener('change', function() {
  document.getElementById('notifSmsRow').style.display = this.checked ? 'block' : 'none';
});
document.getElementById('notifEmail')?.addEventListener('change', function() {
  document.getElementById('notifEmailRow').style.display = this.checked ? 'block' : 'none';
});
async function saveNotifSettings() {
  const notifIds = ['notifEnabled','notifExpiry','notifLowStock','notifDebt30','notifStorage',
                    'notifOutStock','notifTechError','notifLogin','notifPwdChange',
                    'notifInApp','notifSMS','notifEmail'];
  for (const id of notifIds) {
    const el = document.getElementById(id);
    if (el) await setSetting(id, el.checked ? '1' : '0');
  }
  const smsPhone = document.getElementById('notifSmsPhone')?.value || '';
  const emailAddr = document.getElementById('notifEmailAddr')?.value || '';
  if (smsPhone) await setSetting('notifSmsPhone', smsPhone);
  if (emailAddr) await setSetting('notifEmailAddr', emailAddr);
  toast('โ ุชู ุญูุธ ุฅุนุฏุงุฏุงุช ุงูุฅุดุนุงุฑุงุช', 'success');
  // Restart notification engine with new settings
  if (typeof initNotifications === 'function') initNotifications();
}

// Load saved notification settings
async function loadNotifSettings() {
  const notifIds = ['notifEnabled','notifExpiry','notifLowStock','notifDebt30','notifStorage',
                    'notifOutStock','notifTechError','notifLogin','notifPwdChange',
                    'notifInApp','notifSMS','notifEmail'];
  for (const id of notifIds) {
    const val = await getSetting(id);
    const el = document.getElementById(id);
    if (el && val !== null) {
      el.checked = (val === '1');
    } else if (el && val === null) {
      // Default: most enabled
      el.checked = ['notifEnabled','notifExpiry','notifLowStock','notifDebt30','notifOutStock','notifLogin','notifPwdChange','notifInApp'].includes(id);
    }
  }
  const smsPhone = await getSetting('notifSmsPhone');
  if (smsPhone) document.getElementById('notifSmsPhone').value = smsPhone;
  const emailAddr = await getSetting('notifEmailAddr');
  if (emailAddr) document.getElementById('notifEmailAddr').value = emailAddr;

  // Apply SMS/Email row visibility
  const smsEl = document.getElementById('notifSMS');
  if (smsEl) document.getElementById('notifSmsRow').style.display = smsEl.checked ? 'block' : 'none';
  const emailEl = document.getElementById('notifEmail');
  if (emailEl) document.getElementById('notifEmailRow').style.display = emailEl.checked ? 'block' : 'none';
  
  // Apply enable/disable state
  const enabled = document.getElementById('notifEnabled')?.checked;
  if (enabled !== undefined) toggleAllNotifs(enabled);
}

// โโ Scale Settings โโ
function toggleScaleSetting() {
  const enabled = document.getElementById('scaleEnabled').checked;
  document.getElementById('scaleConfig').style.display = enabled ? 'block' : 'none';
}
async function saveScaleSettings() {
  await setSetting('scaleEnabled',      document.getElementById('scaleEnabled').checked ? '1' : '0');
  await setSetting('scaleConnectionType', document.getElementById('scaleConnectionType').value);
  await setSetting('scalePort',         document.getElementById('scalePort').value);
  await setSetting('scaleBaudRate',     document.getElementById('scaleBaudRate').value);
  await setSetting('scaleUnit',         document.getElementById('scaleUnit').value);
  await setSetting('scaleDefaultPrice', document.getElementById('scaleDefaultPrice').value);
  toast('โ ุชู ุญูุธ ุฅุนุฏุงุฏุงุช ุงูููุฒุงู', 'success');
}
async function testScaleConnection() {
  toast('๐ ุฌุงุฑู ุงูุจุญุซ ุนู ุงูููุฒุงู...', 'info', 2000);
  // WebSerial API check
  if ('serial' in navigator) {
    toast('โ ุงููุชุตูุญ ูุฏุนู WebSerial โ ูููู ุฑุจุท ุงูููุฒุงู', 'success', 3000);
  } else {
    toast('โ๏ธ ุงููุชุตูุญ ูุง ูุฏุนู WebSerial โ ุงุณุชุฎุฏู Chrome ุฃู Edge', 'warning', 3000);
  }
}
async function readScaleNow() {
  // Simulate scale read โ in production, this reads from WebSerial
  const weight = (Math.random() * 5 + 0.1).toFixed(3);
  const price = parseFloat(document.getElementById('scaleDefaultPrice')?.value) || 0;
  const unit  = document.getElementById('scaleUnit')?.value || 'ูุบ';
  document.getElementById('scalePreview').textContent = `โ๏ธ ${weight} ${unit}`;
  document.getElementById('scalePreviewPrice').textContent = price > 0 ? `ุงูุณุนุฑ: ${(weight * price).toFixed(2)} DA` : 'ุงูุณุนุฑ: ูู ููุญุฏููุฏ';
  toast(`โ๏ธ ูุฑุงุกุฉ: ${weight} ${unit}`, 'info', 2000);
}

// Load sync/scale settings on init
async function loadSyncScaleSettings() {
  const syncEn = await getSetting('syncEnabled');
  if (syncEn === '1') {
    document.getElementById('syncEnabled').checked = true;
    document.getElementById('syncConfig').style.display = 'block';
    document.getElementById('syncServerKey').value = await getSetting('syncServerKey') || '';
    document.getElementById('syncStoreId').value   = await getSetting('syncStoreId') || '';
    const offFirst = await getSetting('syncOfflineFirst');
    document.getElementById('syncOfflineFirst').checked = offFirst !== '0';
  }
  const scaleEn = await getSetting('scaleEnabled');
  if (scaleEn === '1') {
    document.getElementById('scaleEnabled').checked = true;
    document.getElementById('scaleConfig').style.display = 'block';
    document.getElementById('scaleConnectionType').value = await getSetting('scaleConnectionType') || 'serial';
    document.getElementById('scalePort').value            = await getSetting('scalePort') || 'COM3';
    document.getElementById('scaleBaudRate').value        = await getSetting('scaleBaudRate') || '9600';
    document.getElementById('scaleUnit').value            = await getSetting('scaleUnit') || 'ูุบ';
    document.getElementById('scaleDefaultPrice').value    = await getSetting('scaleDefaultPrice') || '';
  }
}

function doLogout() { customConfirm('ูู ุชุฑูุฏ ุชุณุฌูู ุงูุฎุฑูุฌุ', () => { clearSession(); window.location.href = 'index.html'; }); }

init();
</script>
</body>
</html>
