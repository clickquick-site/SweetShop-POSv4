<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>POS DZ - Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ²Ø¹ÙŠÙ†</title>
  <link rel="stylesheet" href="style.css"/>
</head>
<body>
<div class="bg-animated"></div>
<div class="page-wrapper">
  <header class="app-header">
    <button class="menu-btn" id="menuBtn" title="Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©">â˜°</button>
    <span class="store-name" id="headerStoreName">Ø§Ø³Ù… Ø§Ù„Ù…ØªØ¬Ø±</span>
    <!-- Bell injected by app.js via _injectBell() -->
    <div class="app-brand">
      <span class="brand-title">POS DZ</span>
      <span class="brand-clock" id="clockDisplay"></span>
    </div>
  </header>
  <div class="main-content">
    <div class="section-header">
      <a href="sale.html" class="back-btn">â† Ø±Ø¬ÙˆØ¹</a>
      <h2 class="page-title">ğŸšš Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ²Ø¹ÙŠÙ†</h2>
      <button class="btn btn-primary" onclick="openModal('addSupplierModal')">â• Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ±Ø¯ Ø¬Ø¯ÙŠØ¯</button>
    </div>
    <div class="search-bar">
      <span class="search-icon">ğŸ”</span>
      <input type="text" id="supplierSearch" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…ÙˆØ±Ø¯..." oninput="filterSuppliers()"/>
    </div>
    <div class="card" style="padding:0;overflow:hidden;">
      <table class="data-table">
        <thead><tr><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„Ù‡Ø§ØªÙ</th><th>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th><th>Ù†ÙˆØ¹ Ø§Ù„Ù†Ø´Ø§Ø·</th><th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th></tr></thead>
        <tbody id="suppliersTbody"></tbody>
      </table>
    </div>
  </div>
</div>

<!-- Add Supplier Modal -->
<div class="modal-overlay" id="addSupplierModal">
  <div class="modal">
    <div class="modal-header">
      <span class="modal-title" id="supplierModalTitle">â• Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ±Ø¯ Ø¬Ø¯ÙŠØ¯</span>
      <button class="modal-close" onclick="closeModal('addSupplierModal')">âœ•</button>
    </div>
    <input type="hidden" id="editSupplierId"/>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:14px;">
      <div class="input-group">
        <label class="input-label">ğŸ‘¤ Ø§Ù„Ø§Ø³Ù… *</label>
        <input class="input-field" type="text" id="supplierName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ±Ø¯"/>
      </div>
      <div class="input-group">
        <label class="input-label">ğŸ“ Ø§Ù„Ù‡Ø§ØªÙ *</label>
        <input class="input-field" type="tel" id="supplierPhone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ"/>
      </div>
      <div class="input-group">
        <label class="input-label">ğŸ“ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label>
        <input class="input-field" type="text" id="supplierAddress" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù†"/>
      </div>
      <div class="input-group">
        <label class="input-label">ğŸ­ Ù†ÙˆØ¹ Ø§Ù„Ù†Ø´Ø§Ø·</label>
        <input class="input-field" type="text" id="supplierActivity" placeholder="Ù…Ø«Ø§Ù„: Ù…ÙˆØ§Ø¯ ØºØ°Ø§Ø¦ÙŠØ©ØŒ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª..."/>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-success" onclick="saveSupplier()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ù…ÙˆØ±Ø¯</button>
      <button class="btn btn-secondary" onclick="clearSupplierForm()">ğŸ—‘ï¸ ØªÙØ±ÙŠØº</button>
      <button class="btn btn-ghost" onclick="closeModal('addSupplierModal')">Ø¥Ù„ØºØ§Ø¡</button>
    </div>
  </div>
</div>

<!-- Sidebar â€” labels only, no icons -->
<div class="sidebar-overlay" id="sidebarOverlay" onclick="closeSidebar()"></div>
<div class="sidebar" id="sidebar">
  <div class="sidebar-header">
    <div class="sidebar-brand">POS DZ</div>
    <div class="sidebar-user" id="sidebarUser"></div>
  </div>
  <nav class="sidebar-nav">
    <a class="nav-item" href="sale.html">
      <span class="nav-label" data-nav="navSale">ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¨ÙŠØ¹</span>
    </a>
    <a class="nav-item" href="inventory.html" data-role="admin,manager">
      <span class="nav-label" data-nav="navInventory">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</span>
    </a>
    <a class="nav-item" href="customers.html" data-role="admin,manager,seller">
      <span class="nav-label" data-nav="navCustomers">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø²Ø¨Ø§Ø¦Ù†</span>
    </a>
    <a class="nav-item" href="reports.html" data-role="admin,manager">
      <span class="nav-label" data-nav="navReports">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø¹Ù…Ø§Ù„</span>
    </a>
    <a class="nav-item" href="users.html" data-role="admin">
      <span class="nav-label" data-nav="navUsers">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</span>
    </a>
    <a class="nav-item" href="suppliers.html" data-role="admin,manager">
      <span class="nav-label" data-nav="navSuppliers">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ²Ø¹ÙŠÙ†</span>
    </a>
    <a class="nav-item" href="settings.html" data-role="admin,manager">
      <span class="nav-label" data-nav="navSettings">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©</span>
    </a>
    <div class="nav-item danger" onclick="doLogout()">
      <span class="nav-label" data-nav="navLogout">Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</span>
    </div>
  </nav>
  <div class="sidebar-footer">POS DZ v6.0.0 | 2026 Ø¨ÙˆØ³ Ø¯ÙŠØ²Ø§Ø¯ Â®</div>
</div>
<div id="toast-container"></div>
<script src="app.js"></script>
<script>
let allSuppliers = [];

async function init() {
  requireRole(['admin', 'manager']);
  await initApp();
  loadSuppliers();
}

async function loadSuppliers() {
  allSuppliers = await dbGetAll('suppliers');
  renderSuppliers(allSuppliers);
}

function renderSuppliers(suppliers) {
  const tbody = document.getElementById('suppliersTbody');
  if (!suppliers.length) {
    tbody.innerHTML = '<tr><td colspan="5" class="empty-state"><div class="empty-icon">ğŸšš</div><p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…ÙˆØ²Ø¹ÙˆÙ†</p></td></tr>';
    return;
  }
  tbody.innerHTML = suppliers.map(s => `<tr>
    <td><b>${s.name}</b></td>
    <td>${s.phone}</td>
    <td>${s.address || 'â€”'}</td>
    <td>${s.activity || 'â€”'}</td>
    <td class="actions">
      <button class="btn btn-sm btn-primary" onclick="editSupplier(${s.id})">âœï¸</button>
      <button class="btn btn-sm btn-danger" onclick="deleteSupplier(${s.id})">ğŸ—‘ï¸</button>
    </td>
  </tr>`).join('');
}

function filterSuppliers() {
  const q = document.getElementById('supplierSearch').value.toLowerCase();
  renderSuppliers(allSuppliers.filter(s =>
    s.name.toLowerCase().includes(q) || s.phone.includes(q) || (s.activity||'').toLowerCase().includes(q)
  ));
}

async function saveSupplier() {
  const id = document.getElementById('editSupplierId').value;
  const name = document.getElementById('supplierName').value.trim();
  const phone = document.getElementById('supplierPhone').value.trim();
  if (!name || !phone) { toast('Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ù‡Ø§ØªÙ Ù…Ø·Ù„ÙˆØ¨Ø§Ù†', 'warning'); return; }
  const data = {
    name, phone,
    address: document.getElementById('supplierAddress').value.trim(),
    activity: document.getElementById('supplierActivity').value.trim(),
    createdAt: new Date().toISOString()
  };
  if (id) { data.id = parseInt(id); await dbPut('suppliers', data); toast('ØªÙ… Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ âœ…', 'success'); }
  else { await dbAdd('suppliers', data); toast('ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© âœ…', 'success'); }
  closeModal('addSupplierModal');
  clearSupplierForm();
  loadSuppliers();
}

async function editSupplier(id) {
  const s = await dbGet('suppliers', id);
  document.getElementById('editSupplierId').value = s.id;
  document.getElementById('supplierName').value = s.name;
  document.getElementById('supplierPhone').value = s.phone;
  document.getElementById('supplierAddress').value = s.address || '';
  document.getElementById('supplierActivity').value = s.activity || '';
  document.getElementById('supplierModalTitle').textContent = 'âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…ÙˆØ±Ø¯';
  openModal('addSupplierModal');
}

async function deleteSupplier(id) {
  const _ok = await customConfirmAsync('Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆØ±Ø¯ØŸ');
  if (!_ok) return;
  await dbDelete('suppliers', id);
  toast('ØªÙ… Ø§Ù„Ø­Ø°Ù', 'success');
  loadSuppliers();
}

function clearSupplierForm() {
  ['editSupplierId','supplierName','supplierPhone','supplierAddress','supplierActivity'].forEach(id => {
    document.getElementById(id).value = '';
  });
  document.getElementById('supplierModalTitle').textContent = 'â• Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ±Ø¯ Ø¬Ø¯ÙŠØ¯';
}

function doLogout() { customConfirm('Ù‡Ù„ ØªØ±ÙŠØ¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ØŸ', () => { clearSession(); window.location.href = 'index.html'; }); }
init();
</script>
</body>
</html>
